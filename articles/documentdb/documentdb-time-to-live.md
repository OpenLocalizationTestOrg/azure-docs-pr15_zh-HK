<properties
   pageTitle="在 DocumentDB 数据与生存时间过期 |Microsoft Azure"
   description="与 TTL，Microsoft Azure DocumentDB 提供了在一段时间后自动清除系统中的文档的能力。"
   services="documentdb"
   documentationCenter=""
   keywords="生存时间"
   authors="kiratp"
   manager="jhubbard"
   editor=""/>

<tags
   ms.service="documentdb"
   ms.devlang="multiple"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="04/28/2016"
   ms.author="kipandya"/>

# <a name="expire-data-in-documentdb-collections-automatically-with-time-to-live"></a>过期自动与生存时间的 DocumentDB 集合中的数据

应用程序可以生成和存储大量数据。 某些数据，如由计算机生成事件数据、 日志和用户会话信息有限的一段时间才有用。 一旦该数据将成为多余的应用程序的需要是安全地清除此数据，并减少应用程序的存储需要。

"生存时间"或 TTL，Microsoft Azure DocumentDB 提供了在一段时间后自动清除数据库中的文档的能力。 可以在集合级别设置，并在每个文档上覆盖默认生存时间。 一旦设置 TTL，集合默认情况下，也可以在文档级别上，DocumentDB 将自动删除存在后这段时间，以秒为单位，自上次修改后的文档。

住在 DocumentDB 的时间使用文档上次修改对偏移量。 为此它所使用的每个文档存在的 _ts 字段。 _Ts 字段是 unix 样式日期时间戳表示的日期和时间。 每次修改文档时，都会更新 _ts 字段。 

## <a name="ttl-behavior"></a>TTL 行为

TTL 功能由 TTL 在两个级别的集合级别和文档级别的属性控制。 值以秒为单位设置，而是被视为从文档上次修改时间︰ _ts 的增量。

 1.  找不到 DefaultTTL
  * 如果缺少 （或设置为空），文档不会自动删除。
  
  * 如果存在和值为"-1"= 无限 – 文档，默认情况下不过期
  
  * 如果存在和值是某个数字 ("n") – 文档过期"n"秒之后最后一次修改

 2.  TTL 的文档︰ 
  * 属性是 DefaultTTL 存在的父集合时才适用。
  
  * 将重写父集合的 DefaultTTL 值。

只要文档已过期 (ttl + _ts > = 当前服务器时间)，该文档被标记为"已过期"。 无操作这些文档上允许在此时间之后，将从执行任何查询的结果中排除。 文档已被物理删除在系统中，并删除背景中才有机会在以后的时间。 这不会占用任何[请求单位 (RUs)](documentdb-request-units.md)从集合预算。

上面的逻辑可以显示以下矩阵︰

|       | 在集合上的 DefaultTTL 缺失/不设置 | DefaultTTL =-1 上集合 | DefaultTTL ="n"集合|
| ------------- |:-------------|:-------------|:-------------|
| TTL 缺少文档| 没有要覆盖文档级别，因为文档和集合都具有 TTL 没有概念。 | 不将此集合中的任何文档。 | 此集合中的文档将过期间隔 n 经过以后。 |
| TTL =-1 在文档上 | 没有要因为集合中没有定义文档可以重写 DefaultTTL 属性在文档级重写。 在文档上的 TTL 是未解释系统。 | 不将此集合中的任何文档。 | 与 TTL =-1 在此集合中的文档将永不过期。 "N"的时间间隔后将过期的所有其他文档。 |
|  TTL = n 在文档上 | 没有要重写在文档级别。 在文档中的 TTL 未解释系统。 | 与 TTL 文档 = n 期满后间隔 n，以秒为单位。 其他文档将继承-1 的间隔，永不过期。 | 与 TTL 文档 = n 期满后间隔 n，以秒为单位。 其他文档将继承"n"间隔从集合。 |


## <a name="configuring-ttl"></a>配置 TTL

默认情况下，默认情况下，所有的 DocumentDB 集合中，并对所有文档禁用生存时间。

## <a name="enabling-ttl"></a>启用 TTL

若要启用 TTL 在集合中或在一个集合中的文档，您需要将集合中的 DefaultTTL 属性设置为-1 或为非零正数。 DefaultTTL 为-1 意味着，通过设置的默认集合中的所有文档将都生存下去，但 DocumentDB 服务应监视此集合的文档已重写此默认值。

## <a name="configuring-default-ttl-on-a-collection"></a>在一个集合上配置默认的 TTL

您将能够配置默认集合级别生存时间。 

若要在集合中设置 TTL，您需要提供一个非零正数，指示的期间，以秒为单位，到期之后最后一次修改的时间戳 (_ts) 的文档集合中的所有文档。

或者，可以将默认值设置为-1，这意味着向集合中插入的所有文档，默认情况下无限期地都生存。

## <a name="setting-ttl-on-a-document"></a>在文档上设置 TTL

除了在集合中设置默认 TTL 可以在文档级别设置特定 TTL。 执行此操作将重写默认值的集合。

若要在文档上设置 TTL，您需要提供一个非零正数指示的期间，以秒为单位，以使文档过期后 (_ts) 的文档上次修改的时间戳。

若要设置此到期时间偏移量，请在文档上设置 TTL 字段。

如果文档没有 TTL 字段，将应用默认值的集合。

如果 TTL 在集合级别禁用，文档中的 TTL 字段将被忽略，直到在集合上再次启用 TTL。


## <a name="extending-ttl-on-an-existing-document"></a>扩展现有的文档上的 TTL

可以通过执行任何写操作在文档上的重置文档上的 TTL。 这样，会将 _ts 设置为当前时间，并为文档到期，由 ttl 设置倒计时将重新开始。

如果您想要更改文档的 ttl，才能更新该字段，就像使用任何其他可设置的字段。


## <a name="removing-ttl-from-a-document"></a>从文档中移除 TTL

如果 TTL 设置文档，您不再需要该文档过期，然后可以检索该文档、 将 TTL 字段中删除并替换服务器上的文档。

从文档删除的 TTL 字段后，将应用集合的默认值。

停止从过期的文档并不继承该集合则需要 TTL 值设置为-1。


## <a name="disabling-ttl"></a>禁用 TTL

若要禁用完全在一个集合上的 TTL，停止从查找集合上的 DefaultTTL 属性应删除过期的文档的后台进程。

删除此属性是不同于将其设置为-1。 设置为-1 表示添加到集合中的新文档将生存下去，但您可以覆盖此集合中的特定文档。

完全从集合中移除该属性意味着，将过期的文档，即使文档已显式重写以前的默认值。


## <a name="faq"></a>常见问题

**什么将 TTL 的成本我？**

没有为 TTL 设置文档无需额外成本。

**TTL 是向上后删除文档需要多长时间？**

文档被标记为不可用，只要文档已过期 (ttl + _ts > = 当前服务器时间)。 无操作这些文档上允许在此时间之后，将从执行任何查询的结果中排除。 在后台系统上物理上删除文档。 这不会占用任何 RUs 从集合的预算。

**如果它要花一段时间，若要删除文档，将它们计入我的配额 （和汇票） 直到它们被删除？**

否，文档过期后将不记帐来存储这些文档，文档的大小将不计入集合的存储配额。

**将文档上的 TTL RU 费用产生任何影响？**

不行，会不会影响 RU DocumentDB 在任何文档上执行的操作费用上。

**将删除文档上我有我的收藏设置的吞吐量的影响？**

否，针对您的收藏集的请求提供服务会收到优先级上运行的后台进程，若要删除文档。 将 TTL 添加到任何文档不会影响此。

**文档过期时，多长时间将它保留在我的收藏直到被删除？**

只要文档过期它将不再可访问。 确切时间文档将保留在您的收藏真正删除具有不确定性和无法删除文档后台进程时将根据之前。

**在所有节点，删除过期的文档，还是"最终 consistent?"**

文档将变得不可用在同一时间在所有节点和所有地区。

**有的 TTL 监视后台任务 RU 成本吗？**

否，没有为此 RU 免费。

**TTL 过期时间检查的频率？**

检查 TTL 过期时间作为后台进程不会发生。 在响应请求时后端服务将执行检查现场，排除任何已过期的文档。 删除的物理文档是唯一以异步方式在后台运行的进程。 在此过程中的频率取决于集上可用的 RUs。

**TTL 功能仅适用于整个文档，或者可以终止单个文档属性值？**

TTL 将应用于整个文档。 如果您想要过期文档的一部分，然后建议您从主文档中的部分提取到一个单独的"链接"文档，并对提取文档使用 TTL。

**TTL 功能是否有任何特定的索引要求？**

是的。 集合必须具有迟缓或一致的[索引策略设置](documentdb-indexing-policies.md)。 尝试设置 DefaultTTL 集合的索引设置为无将导致错误，因为将试图关闭在具有已设置 DefaultTTL 的集合索引。


## <a name="next-steps"></a>下一步行动

若要了解有关 Azure DocumentDB 的详细信息，请参考服务[*文档*](https://azure.microsoft.com/documentation/services/documentdb/)页中找到。





<properties
   pageTitle="Azure AD 连接同步︰ 了解该体系结构 |Microsoft Azure"
   description="本主题介绍 Azure AD 连接同步的体系结构，并说明使用的术语。"
   services="active-directory"
   documentationCenter=""
   authors="andkjell"
   manager="femila"
   editor=""/>

<tags
   ms.service="active-directory"
   ms.workload="identity"
   ms.tgt_pltfrm="na"
   ms.devlang="na"
   ms.topic="article"
   ms.date="08/31/2016"
   ms.author="billmath"/>

# <a name="azure-ad-connect-sync-understanding-the-architecture"></a>Azure AD 连接同步︰ 了解该体系结构
本主题介绍 Azure AD 连接同步的基本体系结构。 在许多方面是相似 MIIS 2003，ILM 2007 和 FIM 2010 其前置任务。 Azure AD 连接同步是这些技术的发展。 如果您熟悉任何一种早期的技术，本主题的内容将会同样熟悉。 如果您没有同步，本主题适用于您。 但是不是需要知道要成功地进行自定义 （称为本主题中的同步引擎） 的 Azure AD 连接同步此主题的详细信息。

## <a name="architecture"></a>体系结构
同步引擎创建的对象存储在多个连接的数据源的集成的视图和管理这些数据源中的标识信息。 此集成的视图取决于从连接的数据源和一套规则，用于确定如何处理该信息检索的标识信息。

### <a name="connected-data-sources-and-connectors"></a>连接的数据源和连接器
同步引擎处理不同的数据存储库中，如 Active Directory 或 SQL Server 数据库的标识信息。 每个数据存储库的组织类似数据库的格式的数据并提供标准的数据访问方法是同步引擎的潜在数据源候选人。 同步引擎同步数据存储库被称为**连接的数据源**或**连接目录**(CD)。

同步引擎封装与模块称为**连接器**中的连接的数据源进行交互。 连接的数据源的每个类型都有特定的连接器。 该连接器将转换为所连接的数据源能够理解的格式所需的操作。

连接器与连接的数据源进行 API 调用来交换身份信息 （读和写）。 它也是可以添加使用可扩展连接框架的自定义连接器。 下图显示了连接器同步引擎连接一个已连接的数据源的方式。

![显示 Arch1](./media/active-directory-aadconnectsync-understanding-architecture/arch1.png)

数据可以在两个方向流动，但不能在这两个方向同时流动。 换句话说，可以将连接器配置为允许数据流动从同步引擎连接的数据源或连接的数据源，同步引擎，但这些操作之一可能发生在任何时间为一个对象和属性。 方向可以是对于不同对象和不同的属性不同。

要配置连接器，请指定您想要同步的对象类型。 指定的对象类型定义的同步过程中包含的对象的范围。 下一步是选择的特性要同步，这就所谓的一个属性包含列表。 这些设置可以更改以响应更改的任何时候为您的业务规则。 当使用 Azure AD 连接安装向导时，为您配置这些设置。

若要将对象导出到已连接的数据源，属性包含列表中必须至少包括已连接的数据源中创建特定的对象类型所需的最小特性。 例如， **sAMAccountName**属性必须包含将用户对象导出到 Active Directory，因为所有用户在 Active Directory 中的对象必须都有一个**sAMAccountName**属性，该属性定义属性包含列表中。 再次，安装向导会为您此配置。

如果连接的数据源使用的结构组件，如分区或容器来组织对象，您可以限制已连接的数据源中用于给定的解决方案的区域。

### <a name="internal-structure-of-the-sync-engine-namespace"></a>同步引擎名称空间的内部结构
整个同步引擎命名空间包含两个命名空间所存储的标识信息。 有两个命名空间︰

- 连接器空间 (CS)
- 元节 (MV)

**连接器空间**是包含对象的表示形式指定连接的数据源和属性包含列表中指定的属性从临时区域。 同步引擎使用连接器空间来确定连接的数据源中更改内容和来暂存传入更改。 同步引擎还使用连接器空间转移出站的更改导出到连接的数据源。 同步引擎维护不同的连接器空间作为临时区域的每个连接器。

通过使用临时区域，同步引擎将保持独立的连接的数据源和不受它们的可用性和可访问性。 因此，您可以临时区域中使用的数据处理标识信息的任何时候。 同步引擎可以请求内部连接的数据源后做最后一次通信会话已终止或出仅将更改推入到连接的数据源尚未收到，从而减少了同步引擎和连接的数据源之间的网络通信的标识信息的更改。

此外，同步引擎将存储有关阶段的连接器空间中的所有对象的状态信息。 当收到新的数据时，同步引擎将始终计算是否已同步数据。

**元节**是包含来自多个连接的数据源，提供所有的组合对象的单个全局、 集成视图的集合的标识信息的存储区。 元节对象创建基于从连接的数据源和一套规则，允许您自定义同步过程中检索的标识信息。

下图显示了连接器空间名称空间和元节命名空间内同步引擎。

![Arch2](./media/active-directory-aadconnectsync-understanding-architecture/arch2.png)

## <a name="sync-engine-identity-objects"></a>同步引擎标识对象
同步引擎中的对象所连接的数据源中的任一对象的表示形式或这些对象的同步引擎的集成的视图。 同步引擎的每个对象必须具有一个全局唯一标识符 (GUID)。 Guid 提供数据完整性与对象之间的明确关系。

### <a name="connector-space-objects"></a>连接器空间对象
同步引擎通信时使用的连接的数据源，它读取连接的数据源中的标识信息，并使用该信息来创建连接器空间中标识对象的表示形式。 您不能创建或删除这些对象，分别。 但是，您可以手动删除连接器空间中的所有对象。

连接器空间中的所有对象都具有两个属性︰

- 全局唯一标识符 (GUID)
- 可分辨的名称 (也称为 DN)

如果连接的数据源为对象分配一个唯一的属性，然后连接器空间中的对象也可以定位特性。 定位属性唯一地标识连接的数据源中的对象。 同步引擎使用锚点连接的数据源中找到此对象的相应表示。 同步引擎假定对象的锁定标记永远不会更改该对象的生命周期。

许多的连接器使用已知的唯一标识符来导入时生成自动的每个对象的锚点。 例如，活动目录连接器使用锚**objectGUID**特性。 对于不提供一个明确定义的唯一标识符的连接的数据源，可以指定锚点生成作为连接器配置的一部分。

锚点的情况下，生成从一个或更多的对象类型的唯一属性，既不能的改变，以及唯一标识 （例如，一个雇员编号或用户 ID） 的连接器空间中的对象。

连接器空间对象可以是以下之一︰

- 临时对象
- 占位符

### <a name="staging-objects"></a>临时对象
临时对象表示连接的数据源中的指定的对象类型的实例。 除了 GUID 和可分辨的名称，临时对象始终具有一个值，该值指示对象类型。

暂存对象总是已导入具有锚点属性的值。 临时对象的新同步引擎配置和连接的数据源中创建的过程中没有定位点属性的值。

暂存对象还带有业务特性和操作信息同步引擎来执行同步过程所需的当前值。 操作信息包括这些标志指示的临时对象转移的更新类型。 如果临时对象尚未处理连接的数据源中接收新的标识信息，该对象将被标记为**挂起导入**中。 如果临时对象尚未导出到连接的数据源的新标识信息，则将其标记为**挂起的导出**。

导入对象或导出对象，可以是临时对象。 同步引擎使用对象连接的数据源中接收到的信息来创建导入对象。 同步引擎接收信息存在匹配一个连接器中选择的对象类型的新对象，它会创建导入对象连接器空间中的连接的数据源中的对象表示形式。

下图显示一个表示连接的数据源中的对象导入对象。

![Arch3](./media/active-directory-aadconnectsync-understanding-architecture/arch3.png)

同步引擎创建导出对象通过使用中元节对象信息。 导出对象在下一次通信会话期间导出到已连接的数据源。 同步引擎的角度来看，从导出的对象中不存在连接的数据源尚未。 因此，导出对象的定位属性不可用。 从同步引擎接收对象后，连接的数据源将创建该对象的锚点属性的值是唯一。

下面的插图显示如何使用在元节中的标识信息创建导出对象。

![Arch4](./media/active-directory-aadconnectsync-understanding-architecture/arch4.png)

同步引擎重新导入已连接的数据源中的对象通过确认导出的对象。 导出对象成为导入对象时该连接的数据源中的下一步导入过程中的同步引擎接收它们。

### <a name="placeholders"></a>占位符
同步引擎使用平面命名空间来存储对象。 但是，某些连接的数据源 （如活动目录） 使用分层命名空间。 将分层命名空间中的信息转换为平面命名空间，同步引擎使用占位符来保留的层次结构。

每个占位符代表对象的层次结构名称不导入同步引擎，但需构造层次结构名称的组件 （例如，组织单位）。 他们可以填补由连接的数据源中不转移连接器空间中的对象的对象的引用。

同步引擎还使用占位符来存储引用不还已导入的对象。 例如，如果同步配置为包括管理器属性*Abbie Spencer*对象和已接收的值是对象已不被导入，如*CN = Lee Sperry，CN = 用户，DC = fabrikam，DC = com*，管理者的信息存储为连接器空间中的占位符。 如果以后导入管理器对象时，占位符对象表示该管理器的临时对象被覆盖。

### <a name="metaverse-objects"></a>元节对象
元节对象包含聚合的视图的同步引擎具有连接器空间中的临时对象。 同步引擎通过使用导入对象中的信息创建元节对象。 多个连接器空间对象可以链接到一个单一的元节对象，但无法将连接器空间对象链接到多个元节对象。

元节对象不能手动创建或删除。 同步引擎会自动删除连接器空间中没有链接到任何连接器空间对象的元节对象。

若要连接的数据源中的对象映射到相应的对象类型中元节，同步引擎提供了可扩展架构和一组预定义的对象类型和关联的特性。 您可以创建新的对象类型和属性的元节对象。 属性可以是单值或多值，以及属性类型可以是字符串、 引用、 数字和布尔值。

### <a name="relationships-between-staging-objects-and-metaverse-objects"></a>临时对象与元节对象之间的关系
在同步引擎命名空间中，数据流被启用临时对象与元节对象之间的链接关系。 链接到元节对象的临时对象称为一个**联接对象**（或**连接器对象**）。 未链接到元节对象的临时对象称为**脱离对象**（或**断开器对象**）。 加入和退出的条款被首选不混淆与负责导入和导出连接目录中的数据的连接器。

占位符不会与元节对象

联接的对象包括临时对象和它与单个元节对象的链接的关系。 联接的对象用于同步之间的连接器空间对象和元节对象的属性值。

当一个临时对象，在同步过程中将成为联接的对象时，属性可以临时对象和元节对象之间流动。 属性流是双向的并通过属性规则导入和导出属性规则进行配置。

单个连接器空间对象可以链接到一个元节对象。 但是，元节中的每个对象可以链接到多个连接器空间对象在同一个或不同的连接器空间中如下图中所示。

![Arch5](./media/active-directory-aadconnectsync-understanding-architecture/arch5.png)

临时对象与元节对象之间的链接的关系是永久性的并且可以删除仅由您指定的规则。

分离的对象是未链接到任何的元节对象的临时对象。 分离对象的值的属性处理任何进一步在元节中。 连接的数据源中的相应对象的属性值不会被同步引擎更新。

通过使用分离的对象，可以将标识信息存储在同步引擎和以后对其进行处理。 作为连接器空间中的分离对象保持临时对象具有很多优势。 由于系统已有转移有关此对象所需的信息，不需要连接的数据源中创建此对象的下一步导入过程再次表示。 这样一来，同步引擎始终具有一个完整的快照的连接的数据源，即使没有当前连接到已连接的数据源。 分离的对象可转换到联接的对象，或进行相反的转换，具体取决于您指定的规则。

分离对象创建的导入对象。 导出对象必须是一个连接的对象。 系统逻辑强制实施此规则，并删除不是联接的对象的每个导出对象。

## <a name="sync-engine-identity-management-process"></a>同步引擎标识管理流程
身份管理过程控制标识信息之间不同的连接的数据源的更新方式。 标识管理出现在三个过程︰

- 导入
- 同步
- 导出

在导入过程中，同步引擎会评估传入连接的数据源中的标识信息。 当检测到更改时，它创建新的临时对象，或者更新现有同步连接器空间中的临时对象。

在同步过程中，同步引擎更新元节，以反映在连接器空间中发生的更改，并更新连接器空间，以反映在元节中发生的更改。

在导出过程中，同步引擎将的更改转移临时对象上，并被标记为挂起出口出。

下图显示每个进程发生为标识信息流程从一个已连接的数据源到另一个。

![Arch6](./media/active-directory-aadconnectsync-understanding-architecture/arch6.png)

### <a name="import-process"></a>导入过程
在导入过程中，同步引擎会评估对标识信息的更新。 同步引擎将从临时对象的标识信息的连接的数据源接收的身份信息进行比较，并确定临时对象是否需要更新。 如果有必要使用新数据更新临时对象，临时对象标记为挂起导入。

通过分段同步前连接器空间中的对象，同步引擎可以处理已更改的标识信息。 此过程提供了以下好处︰

- **高效的同步**。 在同步期间处理的数据量最小化。
- **有效地重新同步**。 您可以更改同步引擎如何处理而无需重新连接到数据源的同步引擎的标识信息。
- **若要预览同步的机会**。 您可以预览同步验证您身份管理过程有关的假设正确。

每个对象指定连接器中，同步引擎首先尝试找到该连接器的连接器空间对象的表示形式。 同步引擎检查连接器空间中的所有临时对象，并将尝试查找具有匹配的定位特性的相应临时对象。 如果没有现有的临时对象具有匹配的定位属性，同步引擎将尝试查找相应的临时对象具有相同的可分辨名称。

当同步引擎找到匹配的可分辨名称，但不能通过定位一个临时对象时，将发生以下特殊行为︰

- 如果连接器空间中的对象没有锚，同步引擎从连接器空间中删除此对象，并将标记作为**重试设置在下一次同步运行**链接到的元节对象。 然后它创建新的导入对象。
- 如果连接器空间中的对象具有一个锚点，然后同步引擎假定，此对象已被重命名或删除连接目录中。 以便它可以阶段传入的对象分配的连接器空间对象一个临时的、 新的可分辨的名称。 旧对象将成为**瞬间**，等待要导入的重命名或删除操作来解决该问题的连接器。

如果同步引擎找到一个临时对象，该对象与指定连接器中的对象相对应，它确定要应用的更改的类型。 例如，同步引擎可能重命名或删除连接的数据源中的对象或者它可能只更新对象的属性值。

使用更新的数据的临时对象都被标记为挂起导入。 挂起的导入不同类型不可用。 根据导入过程的结果，连接器空间中的临时对象具有以下待定的导入类型之一︰

- **无**。 无需更改任何临时对象的属性不可用。 同步引擎不会标记为挂起导入这种类型。
- **添加**。 暂存对象是连接器空间中一个新的导入对象。 同步引擎标记为挂起为元节中的额外处理导入这种类型。
- **更新**。 同步引擎连接器空间中查找相应的临时对象和标志与待导入此类型，以便可以在元节中处理属性的更新。 更新包含对象重命名。
- **删除**。 同步引擎连接器空间中查找相应的临时对象，以便可以删除联接的对象标志为挂起导入此类。
- **删除/添加**。 同步引擎在连接器空间中，找到相应的临时对象，但对象类型不匹配。 在这种情况下，删除添加的修改被转移。 A 删除添加同步引擎指示修改此对象的完整的重新同步必须发生，因为不同的规则集时对象类型更改应用于此对象。

通过设置挂起导入状态的临时对象，就可以大大减少处理在同步过程中，因为这样做将允许系统来处理那些已更新的数据的对象的数据量。

### <a name="synchronization-process"></a>同步过程
同步包括两个相关的过程︰

- 入站的同步，元节中的内容通过使用连接器空间中的数据更新时。
- 出站同步，使用在元节中的数据更新时连接器空间的内容。

使用连接器空间转移的信息，站的同步过程将创建在元节中连接的数据源中存储的数据的集成的视图。 根据如何配置规则聚合所有的临时对象，还是只有那些具有挂起导入信息。

元节对象更改时，出站的同步过程更新导出对象。

入站的同步创建中元节从连接的数据源接收的标识信息的集成的视图。 同步引擎可以从连接的数据源使用最新的标识信息，它具有处理标识信息的任何时候。

**入站的同步**

入站的同步包括以下过程︰

- **资源调配**（也称为**投影**是否应当区分这一过程从出站同步资源调配）。 同步引擎创建新的元节对象基于临时对象上，并链接它们。 供应的对象级运算。
- **联接**。 同步引擎链接到现有的元节对象的临时对象。 联接的对象级运算。
- **导入属性流**。 同步引擎更新调用属性流中元节, 对象的属性值。 导入属性流的特性级运算需要临时对象与元节对象之间的链接。

规定是在元节中创建的对象的唯一进程。 设置影响仅是分离的对象的导入对象。 在规定期间同步引擎创建的元节对象对应的导入对象的对象类型，这两个对象，从而创建一个联接的对象之间建立链接。

加入的过程还建立导入对象和元节对象之间的链接。 联接和规定之间的差异是加入进程，需要导入对象链接到已有的元节对象，调配过程创建一个新的元节对象的位置。

同步引擎将尝试通过使用同步规则配置中指定的条件加入元节对象的导入对象。

在联接或规定过程中，同步引擎的元节对象，使它们加入到链接分离的对象。 这些对象级操作完成后，同步引擎可以更新相关联的元节对象的属性值。 此过程称为导入属性流。

在执行新的数据和链接到的元节对象的所有导入对象上发生导入属性流。

**出站同步**

出站同步更新导出对象时元节对象更改，但不是会被删除。 出站同步的目的是评估是否与元节对象的更改需要更新到连接器空间中的临时对象。 在某些情况下，所做的更改可以要求该临时更新所有连接器空间中的对象。 临时对象的更改都被标记为挂起导出，使它们导出的对象。 这些对象以后推送到已连接的数据源导出过程中导出。

出站同步有三个进程︰

- **资源调配**
- **撤消**
- **导出属性流**

资源调配和撤消是这两个对象级操作。 撤消取决于资源调配因为只提供可以启动它。 撤消调配中元节对象与导出对象之间的链接移除时触发。

更改将应用到中元节对象时，始终将触发资源调配。 当与元节对象进行更改时，同步引擎可以执行以下任务中的任何设置过程的一部分︰

- 创建联接的对象，其中将元节对象链接到新创建的导出对象。
- 重命名一个连接的对象。
- Disjoin 元节对象与临时对象，创建一个分离的对象之间的链接。

如果资源调配需要同步引擎将创建一个新的连接器对象，元节对象链接到该临时对象将始终导出对象，因为连接的数据源中尚不存在的对象。

如果资源调配需要同步引擎 disjoin 联接的对象，创建一个分离的对象，撤消时触发。 Deprovisioning 的过程中删除对象。

撤消，期间删除导出对象不会实际删除该对象。 该对象将被标记为**删除**，这意味着删除操作被转移的对象上。

导出属性流也会发生在出站的同步过程中，站在同步过程中，发生导入属性流的方式类似。 导出属性流发生仅为元节和导出连接的对象。

### <a name="export-process"></a>导出进程
在导出过程中，同步引擎检查所有导出对象标记为挂起连接器空间中，在导出，然后将更新发送给已连接的数据源。

同步引擎可以确定成功的出口，但它不能充分确定身份管理过程已完成。 始终可以由其他进程更改连接的数据源中的对象。 因为同步引擎并没有永久连接到已连接的数据源，它不足以仅基于成功导出通知连接的数据源中进行假设对象的属性。

例如，连接的数据源中的进程可以更改对象的属性恢复为其原始值 （即，连接的数据源无法覆盖的值由同步引擎将其推送数据并将数据连接的数据源中的成功应用后，立即）。

同步引擎存储导出和导入每一个临时对象的状态信息。 如果自上次导出后，属性包含列表中指定的属性的值已更改，存储将导入和导出状态使同步引擎，以作出相应的反应。 同步引擎将使用在导入过程以确认已导出到连接的数据源的属性值。 下面的插图所示之间导入和导出的信息，比较使同步引擎，以确定导出是否成功，或者它是否需要重复。

![Arch7](./media/active-directory-aadconnectsync-understanding-architecture/arch7.png)

例如，如果同步引擎导出特性 C 中，其值为 5，给已连接的数据源，它导出状态内存中存储 C = 5。 此对象会导致试图导出 C = 5 到已连接的数据源再次因为同步引擎假定，此值尚未永久应用于对象 （即，除非一个不同的值从导入最近连接的数据源） 上的每个其他导出。 在对象的导入操作期间收到 C = 5 时清除导出内存。

## <a name="next-steps"></a>下一步行动
了解更多有关[Azure AD 连接同步](active-directory-aadconnectsync-whatis.md)配置。

了解有关[将您的内部标识使用 Azure Active Directory 集成](active-directory-aadconnect.md)。

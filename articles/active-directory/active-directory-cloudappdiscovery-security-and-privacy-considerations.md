<properties
    pageTitle="云应用程序发现安全和隐私注意事项 |Microsoft Azure"
    description="本主题介绍与云应用程序发现相关的安全和隐私注意事项。"
    services="active-directory"
    documentationCenter=""
    authors="markusvi"
    manager="femila"
    editor=""/>

<tags
    ms.service="active-directory"
    ms.workload="identity"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/10/2016"
    ms.author="markusvi"/>

# <a name="cloud-app-discovery-security-and-privacy-considerations"></a>云应用程序发现安全和隐私注意事项

Microsoft 致力于保护您的隐私并保护您的数据，同时提供软件和服务帮助您管理您的组织的安全。 <br>
我们认识，委托给其他人，您的数据时信任需要严格的安全工程投资和专业知识来支持它。
Microsoft 遵守严格的法规遵从性和安全指导方针从安全的软件开发生命周期做法，用以操作服务。 <br>
加强安全和保护的数据是在 Microsoft 的头等大事。

本主题说明如何收集、 处理，以及在 Azure 活动目录云应用程序发现内保护数据




##<a name="overview"></a>概述

云应用程序发现是 Azure 广告的功能和承载 Microsoft Azure 中。 <br>
云应用程序发现端点代理用于应用程序发现数据收集 IT 管理机。 <br>
所收集的数据是安全地发送通过加密通道到 Azure AD 云应用程序发现服务。 <br>
云应用程序发现数据的组织就在 Azure 门户中可见。 <br>


<center>![云应用程序发现原理](./media/active-directory-cloudappdiscovery-security-and-privacy-considerations/cad01.png)</center> <br>


以下各节按照信息的流动，并描述如何保护您的组织从移动到云应用程序发现服务，并最终对云应用程序搜索门户。



## <a name="collecting-data-from-your-organization"></a>从您的组织中收集数据

若要使用 Azure Active Directory 云应用程序发现功能能够深入了解组织中的员工使用的应用程序，您需要首先将 Azure AD 云应用程序发现端点代理部署到组织中的计算机。

Azure Active Directory 组织 （或其代理） 的管理员可以从 Azure 的门户网站下载代理安装包。 代理可以是手动安装，或者整个组织使用 SCCM 或组策略中的多台计算机中安装。

部署选项的详细说明，请参阅[云应用程序发现组策略部署指南](http://social.technet.microsoft.com/wiki/contents/articles/30965.cloud-app-discovery-group-policy-deployment-guide.aspx)。
<br>

### <a name="data-collected-by-the-agent"></a>通过代理收集的数据

下面的列表中列出的信息收集代理到 Web 应用程序进行连接时。 只有管理员将配置用于发现这些应用程序收集信息。 <br>
您可以编辑该代理监视通过云应用程序发现刀片式服务器的 Microsoft [Azure 的门户](https://portal.azure.com/)，在**设置**下的云应用程序的列表->**数据集**->**应用程序集列表中**。 有关更多详细信息，请参阅[获取启动与云应用程序发现](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)
<br>
**信息类别**︰ 用户信息 <br>
**说明**︰ <br>
到目标 Web 应用程序请求进程的 Windows 用户名称 (例如︰ 域 \ 用户名) 的用户以及 Windows 安全标识符 (SID)。


**信息类别**︰ 处理信息 <br>
**说明**︰ <br>
目标 Web 应用程序发出请求的过程的名称 (例如:"iexplore.exe")

**信息类别**︰ 计算机信息 <br>
**说明**︰ <br>
计算机的 NetBIOS 名称，在其安装代理。

**信息类别**︰ 应用程序通信流信息 <br>
**说明**︰ <br>

以下连接信息︰

- （本地计算机） 的源和目标 IP 地址和端口号

- 该组织通过其请求将转出公用 IP 地址。

- 请求的时间

- 该卷的发送和接收的通信

- IP 版本 （4 或 6）

- TLS 仅用于连接︰ 服务器名称指示扩展或服务器证书从目标主机名。

以下 HTTP 信息︰

- 方法 （GET、 开机自检等）

- 协议 （HTTP/1.1 等）

- 用户代理字符串

- 主机名

- 目标 URI （不包括查询字符串）

- 内容类型信息

- 引用的 URL 信息 （不包括查询字符串）



> [AZURE.NOTE] 上面的 HTTP 信息收集所有非加密的连接。
对于 TLS 连接，深入检查设置中的门户开启时仅捕获此信息。 默认情况下，则设置为 ON。
有关更多详细信息，见下文和[获取启动与云应用程序发现](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)


除了代理收集有关网络活动的数据，它还将收集有关软件和硬件配置、 错误报告和有关如何使用该代理的信息的匿名信息。

<br><br>
### <a name="how-the-agent-works"></a>代理的工作原理

代理安装包括两个组件︰

- 用户模式组件

- 内核模式驱动程序组件 （Windows 筛选平台驱动程序）



首次安装代理时它然后用来建立安全连接的云应用程序搜索服务的计算机上存储特定于计算机的受信任的证书。 <br>
代理定期检索策略配置从云应用程序发现服务通过此安全连接。 <br>
该策略包括监视和是否自动更新应启用，还有其他一些功用的云应用程序有关的信息。

随着 Web 通信已发送和接收来自 Internet Explorer 和镶边的计算机上，云应用程序探测代理分析通信量并提取相关的元数据 （请参见上面的**通过代理收集的数据**部分）。 <br>
每一分钟，代理将上载收集元数据到云应用程序发现服务通过加密通道。

驱动程序组件截获加密的通信，并将自身插入到该加密流。 在下面的**加密连接 （深度检测） 的 Intercepting 数据**一节中的更多详细信息。


### <a name="respecting-user-privacy"></a>尊重用户隐私

我们的目标是提供管理员工具设置为应用程序的使用情况和用户隐私，根据其组织的详细光学器件之间的平衡。 为此，我们提供以下旋钮在门户中的设置页中︰

- **数据收集**︰ 管理员可以选择指定的应用程序或他们想要获得有关搜索数据的应用程序类别。

- **深度检测**︰ 管理员可以选择指定是否代理收集的 SSL/TLS 连接 （亦即**深入检查**） 的 HTTP 通信量。 对此在下一节中的详细信息。

- **许可选项**︰ 管理员可以使用云应用程序发现门户网站选择是否通知用户数据集合代理，并收集用户数据代理启动之前是否要求用户同意。

云应用程序发现端点代理仅收集上述**由代理收集数据**一节中所述的信息。


### <a name="intercepting-data-from-encrypted-connections-deep-inspection"></a>截取数据的加密连接 （深度检测）
如前面提到的管理员可以配置代理来监视数据的加密连接 （深入检查）。 TLS （[传输层安全性](https://msdn.microsoft.com/library/windows/desktop/aa380516%28v=vs.85%29.aspx)） 今天是一种在万维网上使用的最常用的协议。 通过加密通信使用 TLS，客户端可以建立安全和专用通信通道，与 web 服务器;TLS 提供重要传递身份验证凭据的保护和防止敏感信息的泄漏。

重要的安全和隐私的保护，可以启用 TLS 所提供的端到端安全加密的通道，该协议是经常滥用出于恶意或邪恶的目的。 如此这样，事实上，该 TLS 是通常称为"通用防火墙绕过协议"。 问题的根源是，大多数防火墙无法检查 TLS 通信，因为应用程序层数据使用 SSL 加密。 知道这一点，攻击者经常利用 TLS 向用户确信甚至最智能的应用程序层防火墙进行 TLS 完全失明，而且必须只是中继主机之间的 TLS 通信传递恶意负载。 最终用户经常利用 TLS 来绕过访问控制实施按企业防火墙和代理服务器使用它连接到公用代理，以隧道方式传输非 TLS 协议通过防火墙，否则可能会被策略阻止连接。

深度检测允许云应用程序发现代理作为受信任--拦截。 当客户端请求进行访问 HTTPS 受保护的资源时，该终结点的代理驱动程序截获连接，并建立新连接到目标服务器中检索它代表客户端的 SSL 证书。 代理程序然后验证，可以 （通过检查，则它不会被吊销，并执行其他证书检查） 受信任证书，并且如果这些阶段，然后终结点代理复制信息从服务器证书并创建自己的服务器证书-称为拦截证书-使用该信息。 截取证书的签名上动态终结点根证书之后，Windows 可信任的证书存储区中安装的代理。 这个自签名的根证书被标记为不可导出，ACL 必须给管理员。 它是永远不会留在其创建它的计算机。 最终用户的客户端应用程序收到截取证书时，它将信任它，因为它可以成功验证一直到根证书的证书链。 这一过程主要是从最终用户的角度看具有如下所述的几点忠告透明的。

通过启用深度检测，云应用程序发现端点代理可以解密和检查 TLS 加密的通信，从而降低噪声，并提供洞见的加密的云应用程序使用的服务。

#### <a name="a-word-of-caution"></a>需要注意的一点
之前开启深度检测，强烈建议您传达您向您的法律部门和人力资源部门的意图，并获得其同意。 检查最终用户的私有加密的通信可以是一个敏感的主题，原因很明显。 之前生产推广的深度检测，请确保您公司的安全和可接受的使用策略已更新，以指示，将检查加密的通讯。 用户通知和免除被视为敏感的网站 （如银行业和医疗网站） 的可能也有必要如果配置来监视他们的云应用程序发现。 正如前面提到的管理员可以使用云应用程序发现门户选择是否通知用户代理，数据收集，以及是否要求用户同意的情况下，代理开始收集用户数据之前。

### <a name="known-issues-and-drawbacks"></a>已知的问题和缺陷
有几个 TLS 拦截可能会影响最终用户体验的情况下︰

- 扩展的验证 (EV) 证书呈现绿色作为直观您正在访问受信任的 web 站点的 web 浏览器的地址栏。 TLS 检查不能重复 EV 中以便使用 EV 证书的 web 站点将会正常工作，客户端，它发出的证书，但地址栏将不会显示绿色。  

- 公用密钥固定 （也称为证书固定） 旨在帮助保护用户免遭人为干预攻击以及无管理证书颁发机构。 固定的站点的根证书不匹配已知良好 CA 之一，浏览器将拒绝连接，出现错误。 由于 TLS 拦截，事实上，--拦截，这些连接将会失败。

- 如果用户单击浏览器地址栏浏览器来检查站点信息的锁状图标，他们将看不到结束在用于签署该网站证书，该证书颁发机构链，但改为结束使用 Windows 证书链受信任证书存储区。

若要减少出现的这些问题，我们可以跟踪的云服务和客户端应用程序知道使用扩展的验证或公共密钥固定并指示代理终结点以避免截取受影响的连接。 即使在这些情况下，但是，您仍然会收到报告，这些云应用程序和正在传输的数据量，但没有深入检查，因为没有有关如何使用应用程序的详细信息将提供。


## <a name="sending-data-to-cloud-app-discovery"></a>将数据发送到云中的应用程序发现

一旦已经通过代理收集的元数据，它缓存在计算机上达一分钟或直到缓存的数据达到一个大小为 5 MB。 然后是压缩并发送通过安全连接到云应用程序发现服务。

如果代理不能出于任何原因的云应用程序搜索服务进行通信，只有特权用户 （如管理员组) 的计算机上访问本地文件缓存中存储收集的元数据。 <br>
代理程序会自动尝试重新发送缓存的元数据，直到成功接收的云应用程序发现服务。



## <a name="receiving-the-data-at-the-service-end"></a>接收服务端上的数据

代理到云应用程序发现使用计算机特定的客户端身份验证证书服务上面引用，并将数据转发通过加密通道进行身份验证。 <br>
云应用程序发现服务的分析管道处理元数据为每个客户分别通过分析管道的所有阶段进行逻辑分区。
分析元数据驱动器在门户中的各种报告。

未处理的元数据和分析元数据存储最多 180 天。 此外，客户可以选择捕获分析元数据在他们选择的 Azure blob 存储帐户。
这是很有用的元数据的离线分析，以及更长时间保留的数据。

## <a name="accessing-the-data-using-the-azure-portal"></a>访问使用 Azure 门户数据

努力确保收集的元数据的安全，默认情况下只有全局管理员的租户有权云应用程序发现功能在 Azure 的门户。 <br>
但是，管理员可以选择委派给其他用户或组的此访问权限。



> [AZURE.NOTE] 有关更多详细信息，请参阅[获取启动与云应用程序发现](http://social.technet.microsoft.com/wiki/contents/articles/30962.getting-started-with-cloud-app-discovery.aspx)

<br>
在门户中，数据访问的任何用户必须使用 Azure AD 特优的许可证授权。



##<a name="additional-resources"></a>其他资源


* [如何在我的组织内发现未批准的云应用程序使用](active-directory-cloudappdiscovery-whatis.md)
* [在 Azure 的 Active Directory 中的应用程序管理的文章索引](active-directory-apps-index.md)

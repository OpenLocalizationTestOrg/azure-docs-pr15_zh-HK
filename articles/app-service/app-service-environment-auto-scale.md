<properties
    pageTitle="自动缩放和应用程序服务环境 |Microsoft Azure"
    description="自动缩放和应用程序服务环境"
    services="app-service"
    documentationCenter=""
    authors="btardif"
    manager="wpickett"
    editor=""
/>

<tags
    ms.service="app-service"
    ms.workload="web"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="10/24/2016"
    ms.author="byvinyal"
/>

# <a name="autoscaling-and-app-service-environment"></a>自动缩放和应用程序服务环境

Azure 应用程序服务环境支持*自动缩放*。 您可以自动缩放个体工作者池基于指标或日程安排。

![自动缩放比例选项辅助池。][intro]

自动缩放通过自动增大和缩小以适合您的预算和或者加载的配置文件应用程序服务环境来优化您的资源利用率。

## <a name="configure-worker-pool-autoscale"></a>配置辅助池自动缩放比例

从辅助池**设置**选项卡上，可以访问自动缩放功能。

![辅助池设置选项卡。][settings-scale]

据此，界面应该是相当熟悉，因为它是相同的体验，您会看到当您扩展应用程序服务计划。 

![手动缩放设置。][scale-manual]

您还可以配置自动缩放配置文件。

![自动缩放设置。][scale-profile]

自动缩放比例配置文件可在您扩展设置限制。 这种方式，您可以体验通过设置下限比例值 （1） 和可预测的开支上限，通过设置一个上限 (2) 一致的性能。

![扩展配置文件中的设置。][scale-profile2]

定义配置文件后，可以添加自动缩放比例规则进行放大或缩小在辅助池配置文件定义的边界内的实例数。 自动缩放比例规则基于指标。

![范围规则。][scale-rule]

 任何工作池或前端的指标可用于定义自动缩放比例规则。 这些指标是可以监视资源刀片图形方式显示，也可以设定警报的同一指标。

## <a name="autoscale-example"></a>自动缩放示例

自动缩放的应用程序服务环境可以最好地说明了逐步介绍方案中。

设置自动缩放时，本文介绍了所有的必要考虑因素。 文章将引导您完成应用程序服务环境中承载的应用程序服务环境中自动缩放因子时派上用场的交互。

### <a name="scenario-introduction"></a>方案介绍

Frank 是对已迁移到应用程序服务环境的一部分的工作负荷，他管理着一个企业的系统管理员。

应用程序服务环境配置为手动比例如下︰

* **前结束︰** 3
* **辅助池 1**: 10
* **辅助池 2**: 5
* **辅助池 3**: 5

辅助池 1 用于生产工作负载，而辅助池 2 和辅助池 3 用于质量保证 (QA) 和开发的工作负载。

为 QA 和开发的应用程序服务计划配置为手动缩放。 生产计划应用程序服务设置为自动缩放处理负载和流量的变化。

Frank 是非常熟悉的应用程序。 他知道负载高峰时间是上午 9:00 到下午 6:00 之间，因为这是一个业务线 (LOB) 应用程序，员工使用的都是在办公室。 当用户完成的这一天，使用降到该值之后。 高峰时间之外，还有一些负载因为用户可以通过使用他们的移动设备或家用 Pc 远程访问应用程序。 生产应用程序服务计划已配置为自动缩放比例根据 CPU 的使用情况，使用下面的规则︰

![LOB 应用程序的特定设置。][asp-scale]

|   **自动缩放比例配置文件 – 工作日 – 应用程序服务计划**     |   **自动缩放比例配置文件 – 周末 – 应用程序服务计划**     |
|   ----------------------------------------------------    |   ----------------------------------------------------    |
|   **名称︰**工作日的配置文件                               |   **名称︰**周末的配置文件                               |
|   **通过缩放︰**计划和性能规则            |   **通过缩放︰**计划和性能规则            |
|   **配置文件︰**工作日                                   |   **配置文件︰**周末                                    |
|   **类型︰**重复周期                                    |   **类型︰**重复周期                                    |
|   **目标范围︰** 5 到 20 实例                     |   **目标范围︰** 3 到 10 个实例                     |
|   **天︰**星期一、 星期二、 星期三、 星期四、 星期五  |   **天︰**星期六、 星期日                              |
|   **开始时间︰**上午 9:00                                 |   **开始时间︰**上午 9:00                                 |
|   **所在的时区︰**UTC-08                                   |   **所在的时区︰**UTC-08                                   |
|                                                           |                                                           |
|   **自动缩放比例 （向上扩展） 的规则**                           |   **自动缩放比例 （向上扩展） 的规则**                           |
|   **资源︰**生产 （应用程序服务环境）      |   **资源︰**生产 （应用程序服务环境）      |
|   **规格︰**CPU 百分比                                       |   **规格︰**CPU 百分比                                       |
|   **操作︰**60%以上                         |   **操作︰**超过 80%                         |
|   **持续时间︰** 5 分钟                                 |   **持续时间︰** 10 分钟                                |
|   **次聚合︰**平均值                           |   **次聚合︰**平均值                           |
|   **操作︰**2 增加计数                         |   **操作︰**计数增加 1                         |
|   **冷却 （分钟）︰** 15                             |   **冷却 （分钟）︰** 20                             |
|                                                           |                                                           |
  	|   **自动缩放比例 （缩放比例下） 的规则**                     |   **自动缩放比例 （缩放比例下） 的规则**                         |
|   **资源︰**生产 （应用程序服务环境）      |   **资源︰**生产 （应用程序服务环境）      |
|   **规格︰**CPU 百分比                                       |   **规格︰**CPU 百分比                                       |
|   **操作︰**不到 30%                            |   **操作︰**小于 20%                            |
|   **持续时间︰** 10 分钟                                |   **持续时间︰** 15 分钟                                |
|   **次聚合︰**平均值                           |   **次聚合︰**平均值                           |
|   **操作︰**计数减少 1                         |   **操作︰**计数减少 1                         |
|   **冷却 （分钟）︰** 20                             |   **冷却 （分钟）︰** 10                             |

### <a name="app-service-plan-inflation-rate"></a>应用程序服务计划通货膨胀率

自动缩放到的配置应用程序服务计划执行此操作的最大速度每小时。 可以基于自动缩放比例规则提供的值计算此付薪标准。

理解和计算*应用程序服务计划通货膨胀率*是非常重要的应用程序服务环境自动缩放，因为比例变为辅助池不是瞬时完成。

应用程序服务计划通货膨胀率的计算公式如下︰

![应用程序服务计划通货膨胀率计算。][ASP-Inflation]

基于自动缩放-向上扩展生产应用程序服务计划工作日配置文件的规则︰

![基于自动缩放-向上扩展规则以工作日为应用程序服务计划通货膨胀率。][Equation1]

在自动缩放-向上扩展生产应用程序服务计划的周末配置文件的规则的情况下将解析公式︰

![应用程序服务自动缩放-向上扩展规则所基于的周末计划通货膨胀率。][Equation2]

此外可以向下伸缩操作计算此值。

基于自动缩放-工作日配置文件应用程序服务计划的生产比例下规则这可能看起来如下︰

![基于自动缩放-比例下规则以工作日为应用程序服务计划通货膨胀率。][Equation3]

在自动缩放-比例下周末配置文件应用程序服务计划的生产规则的情况下将解析公式︰  

![应用程序服务自动缩放-比例下规则所基于的周末计划通货膨胀率。][Equation4]

生产应用程序服务计划会变得在一周内的八个实例/小时的最大速度和周末的四个实例/小时。 它可以释放实例的最大速度的四个实例/小时在一周内和六个实例/小时周末。

如果要在辅助池承载多个应用程序服务计划，则必须为所有应用程序服务计划正在通货膨胀率之和计算的*总通货膨胀率*承载在该辅助池。

![在辅助池承载多个应用程序服务计划的总体通货膨胀率计算。][ASP-Total-Inflation]

### <a name="use-the-app-service-plan-inflation-rate-to-define-worker-pool-autoscale-rules"></a>使用应用程序服务计划通货膨胀率定义辅助池自动缩放比例规则

工作人员集中到自动缩放比例配置应用程序服务计划需要分配的缓冲区容量的该主机。 缓冲区允许自动缩放操作，以扩大和收缩所需的应用程序服务计划。 最小缓冲区将计算总的应用程序服务计划通货膨胀率。

因为应用程序服务环境缩放操作需要一些时间来应用，进一步要求更改缩放操作正在进行时可能发生这种情况时予以考虑的任何更改。 为了适应这种延迟，我们建议为每个自动缩放操作计算总的应用程序服务计划通货膨胀率作为添加的最小次数使用。

使用此信息，Frank 可以定义以下自动缩放比例配置文件和规则︰

![自动缩放比例 LOB 的示例配置文件规则。][Worker-Pool-Scale]

|   **自动缩放比例配置文件 – 工作日**                        |   **自动缩放比例配置文件 – 周末**                |
|   ----------------------------------------------------    |   --------------------------------------------    |
|   **名称︰**工作日的配置文件                               |   **名称︰**周末的配置文件                       |
|   **通过缩放︰**计划和性能规则            |   **通过缩放︰**计划和性能规则    |
|   **配置文件︰**工作日                                   |   **配置文件︰**周末                            |
|   **类型︰**重复周期                                    |   **类型︰**重复周期                            |
|   **目标范围︰** 13 到 25 实例                    |   **目标范围︰** 6 到 15 个实例             |
|   **天︰**星期一、 星期二、 星期三、 星期四、 星期五  |   **天︰**星期六、 星期日                      |
|   **开始时间︰**上午 7:00                                 |   **开始时间︰**上午 9:00                         |
|   **所在的时区︰**UTC-08                                   |   **所在的时区︰**UTC-08                           |
|                                                           |                                                   |
|   **自动缩放比例 （向上扩展） 的规则**                           |   **自动缩放比例 （向上扩展） 的规则**                   |
|   **资源︰**辅助池 1                             |   **资源︰**辅助池 1                     |
|   **规格︰**WorkersAvailable                            |   **规格︰**WorkersAvailable                    |
|   **操作︰**小于 8                              |   **操作︰**小于 3                      |
|   **持续时间︰** 20 分钟                                |   **持续时间︰** 30 分钟                        |
|   **次聚合︰**平均值                           |   **次聚合︰**平均值                   |
|   **操作︰**计数增加 8                         |   **操作︰**3 通过增加计数                 |
|   **冷却 （分钟）︰** 180                            |   **冷却 （分钟）︰** 180                    |
|                                                           |                                                   |
|   **自动缩放比例 （缩放比例下） 的规则**                         |   **自动缩放比例 （缩放比例下） 的规则**                 |
|   **资源︰**辅助池 1                             |   **资源︰**辅助池 1                     |
|   **规格︰**WorkersAvailable                            |   **规格︰**WorkersAvailable                    |
|   **操作︰**大于 8                           |   **操作︰**大于 3                   |
|   **持续时间︰** 20 分钟                                |   **持续时间︰** 15 分钟                        |
|   **次聚合︰**平均值                           |   **次聚合︰**平均值                   |
|   **操作︰**计数减少 2                         |   **操作︰**计数减少 3                 |
|   **冷却 （分钟）︰** 120                            |   **冷却 （分钟）︰** 120                    |

在配置文件中定义的目标范围的计算方法在应用程序服务计划 + 缓冲区的配置文件中定义的最小实例。

最大值范围应承载在辅助池的所有应用程序服务计划的最大范围的总和。

规则的比例的增加数应设置为至少 1 个应用程序服务计划通货膨胀率，缩放。

减少数可以调整成之间 1/2 X 或 X 缩放应用程序服务计划通货膨胀率 1 下。

### <a name="autoscale-for-front-end-pool"></a>前端池的自动缩放比例

是比辅助池的简单规则前端自动缩放。 首先，您应该  
请确保持续时间的测量和 cooldown 计时器考虑一个应用程序服务计划的规模操作不是瞬时完成。

针对这种情况下，Frank 知道错误率增加后前端达到 80%的 CPU 使用率并设置自动缩放比例规则，以增加实例，如下所示︰

![自动缩放比例设置为前端的池的。][Front-End-Scale]

|   **自动缩放比例配置文件 – 前端**              |
|   --------------------------------------------    |
|   **名称︰**自动缩放比例 – 前端                |
|   **通过缩放︰**计划和性能规则    |
|   **配置文件︰**每天                           |
|   **类型︰**重复周期                            |
|   **目标范围︰** 3 到 10 个实例             |
|   **天︰**每天                              |
|   **开始时间︰**上午 9:00                         |
|   **所在的时区︰**UTC-08                           |
|                                                   |
|   **自动缩放比例 （向上扩展） 的规则**                   |
|   **资源︰**前端的池                    |
|   **规格︰**CPU 百分比                               |
|   **操作︰**60%以上                 |
|   **持续时间︰** 20 分钟                        |
|   **次聚合︰**平均值                   |
|   **操作︰**3 通过增加计数                 |
|   **冷却 （分钟）︰** 120                    |
|                                                   |
|   **自动缩放比例 （缩放比例下） 的规则**                 |
|   **资源︰**辅助池 1                     |
|   **规格︰**CPU 百分比                               |
|   **操作︰**不到 30%                    |
|   **持续时间︰** 20 分钟                        |
|   **次聚合︰**平均值                   |
|   **操作︰**计数减少 3                 |
|   **冷却 （分钟）︰** 120                    |

<!-- IMAGES -->
[intro]: ./media/app-service-environment-auto-scale/introduction.png
[settings-scale]: ./media/app-service-environment-auto-scale/settings-scale.png
[scale-manual]: ./media/app-service-environment-auto-scale/scale-manual.png
[scale-profile]: ./media/app-service-environment-auto-scale/scale-profile.png
[scale-profile2]: ./media/app-service-environment-auto-scale/scale-profile-2.png
[scale-rule]: ./media/app-service-environment-auto-scale/scale-rule.png
[asp-scale]: ./media/app-service-environment-auto-scale/asp-scale.png
[ASP-Inflation]: ./media/app-service-environment-auto-scale/asp-inflation-rate.png
[Equation1]: ./media/app-service-environment-auto-scale/equation1.png
[Equation2]: ./media/app-service-environment-auto-scale/equation2.png
[Equation3]: ./media/app-service-environment-auto-scale/equation3.png
[Equation4]: ./media/app-service-environment-auto-scale/equation4.png
[ASP-Total-Inflation]: ./media/app-service-environment-auto-scale/asp-total-inflation-rate.png
[Worker-Pool-Scale]: ./media/app-service-environment-auto-scale/wp-scale.png
[Front-End-Scale]: ./media/app-service-environment-auto-scale/fe-scale.png

<properties
    pageTitle="对于能源的需求预测的 Cortana 智能解决方案模板操作手册 |Microsoft Azure"
    description="使用 Microsoft Cortana 智能，可以帮助预测能源公用事业公司的需求解决方案模板。"
    services="cortana-analytics"
    documentationCenter=""
    authors="ilanr9"
    manager="ilanr9"
    editor="yijichen"/>

<tags
    ms.service="cortana-analytics"
    ms.workload="data-services"
    ms.tgt_pltfrm="na"
    ms.devlang="na"
    ms.topic="article"
    ms.date="01/24/2016"
    ms.author="ilanr9;yijichen;garye"/>

# <a name="cortana-intelligence-solution-template-playbook-for-demand-forecasting-of-energy"></a>对于能源的需求预测的 Cortana 智能解决方案模板操作手册  

## <a name="executive-summary"></a>执行摘要  

在过去的几年里，互联网内容 (IoT)、 替代能源来源和大数据合并中的实用程序和能量域创造大量机会。 同时，该实用程序和整个能源部门已经看到拼合与使用者要求更好的方法来控制其使用的能源的消耗。 因此的实用程序和智能网格的公司是需要创新，在更新自己的很好。 此外，很多的电源和设施网格变得过时和非常昂贵的维护和管理。 去年，团队已着手大量能量域内的合作。 在这些案例中，我们遇到很多情况下的实用程序或 Isv （独立软件供应商） 已经调查了未来能源需求预测。 这些预测在其当前和未来的业务中发挥重要作用，已成为各种用例的基础。 其中包括短期和长期电源负载预测、 贸易、 负载平衡、 网格优化等。大数据和高级分析功能 (AA) 方法如机器学习 (ML) 生成准确和可靠的预测是重要促成因素。  

本操作手册，在我们整理的业务和分析指导原则所需的成功开发和部署的能源需求预测的解决方案。 这些建议的原则可以帮助实用程序、 数据科学家，以及在建立完全实施了基于云的、 需求预测解决方案数据工程师。 对于大数据及其高级分析功能之旅刚开始的公司，这种解决方案可以表示在其长期的智能网格战略的初始种子。

>[AZURE.TIP] 若要下载提供的体系结构概述此模板的图表，请参阅[Cortana 智能解决方案模板体系结构的能源需求预测](cortana-analytics-architecture-demand-forecasting-energy.md)。  

## <a name="overview"></a>概述  

本文档介绍业务、 数据和技术方面的使用 Cortana 智能和在特定 Azure 机器学习 (AML) 的实施和能源预测解决方案的部署。 该文档包含三个主要部分︰  

1. 了解业务  
2. 数据了解  
3. 技术实现

**了解业务**部分概述了一个需要了解和作出投资决定前考虑的业务方面。 它说明了如何确认在手边以确保预测分析和机器学习是确实有效和适用的业务问题。 进一步的文档介绍了机器学习和如何使用它来解决能源预测问题的基本知识。 它概述了各项前提条件和用例的资格条件。 某些示例使用用例和业务用例还提供了方案。

数据是任何机器学习解决方案的主要成分。 本文的**数据了解**部分涵盖数据的一些重要方面。 它概述了所需的能源预测、 数据质量要求，和通常存在哪些数据源的数据的种类。 我们还介绍了如何使用原始数据准备实际驱动建模部分的数据功能。

文档的第三部分介绍了一种解决方案的**技术实现**方面。 功能的工程设计和建模数据科学过程的核心是，因此被某些详细讨论。 它涵盖的概念是云的预测分析的解决方案的部署重要载体的 web 服务。 我们还概括的端到端 operationalized 解决方案的典型体系结构。

此外，该文档包含可用来更进一步理解域和技术的参考资料。

值得注意的是，我们不打算涵盖本文档中更深层次的数据科学过程，其数学和技术两个方面。 这些详细信息可以在[Azure ML 文档](http://azure.microsoft.com/services/machine-learning/)和[博客](http://blogs.microsoft.com/blog/tag/azure-machine-learning/)。

### <a name="target-audience"></a>目标访问群体   
本文档的目标读者是业务和技术人员想要获得知识和机器学习的理解基于解决方案以及如何被这些专门能源预测的域中使用。

数据科学家也可以受益于阅读此文档，才能更好地理解高级别的流程，推动能源预测的解决方案的部署。 在此上下文中它也可用来建立一个良好的基准，有关的详细信息的起始点，并详细说明高级材料。

### <a name="industry-trends"></a>行业发展趋势  
在过去的几年里，IoT、 替代能源来源和大数据合并在实用程序和能源领域创造大量机会。 同时，该实用程序和整个能源部门已经看到拼合与使用者要求更好的方法来控制其使用的能源的消耗。

许多工具和智能能源公司拥有已开创了许多[智能网格](https://en.wikipedia.org/wiki/Smart_grid)通过部署大量的使用进行的情况下使用的网格生成的数据。 多个用例都围绕电力生产的固有特征︰ 它无法积累也作为库存保留存储。 因此，必须使用产生。 想要变得更加高效的实用程序需要预测能源消耗只是因为它能为他们带来更大**平衡供应和需求**的能力，从而防止了能量损耗、**减少温室气体排放**和控制成本。

当交谈的成本，没有另一个重要方面，是价格。 在非常需要**预测将来的需求和未来的电力价格**带来了贸易电源分别使用不同的实用程序的新能力。 这可以帮助公司确定其生产卷。

当我们使用智能一词时，我们实际上引用一个网格，可以学习，然后进行预测。 它可以预测消耗量以及**预见短时间超负荷的情况下，自动进行调节**的季节性变化。 通过远程控制消费 （与这些智能米的帮助），本地化的重载情况下可以进行处理。 **第一次预测，然后作用**，网格使自己更聪明地随着时间的推移。

我们将重点介绍了预测的未来，用例的特定系列本文档的其余部分的短期内和长期的能源需求。 我们已经在这些领域中工作几个月，并已获得一些知识和技能，使我们能够产生行业评分结果。 其他用例将介绍以及在文档中在不久的将来。

## <a name="business-understanding"></a>了解业务

### <a name="business-goals"></a>业务目标
**能源演示**目的是演示了一个典型的预测分析和机器学习可以在很短的时间框架中部署的解决方案。 具体来说，我们当前的重点是使能源需求预测的解决方案，以便可以快速实现和利用时的业务价值。 本行动手册中的信息可帮助客户实现以下目标︰
-   短时间值的机器学习基于解决方案
-   能够展开试验用例到其他用例或更大的范围内，根据其业务需要
-   快速获得 Cortana 智能套件产品知识

这些想象中的目标，本操作手册的目的是提供业务和技术知识，有助于实现这些目标。

### <a name="power-load-and-demand-forecasting"></a>电源负载和需求预测
在能源部门中，可能有哪些需求预测可以帮助解决关键的业务问题的许多方面。 事实上，需求预测可以考虑在行业中的许多核心用例的基础。 一般情况下，我们要考虑两种类型的能源需求预测︰ 短期和长期来看。 每个可以用于不同的目的，利用另一种方法。 两者的主要区别是时间的预测区间，意味着我们可以预测，在未来范围。

#### <a name="short-term-load-forecasting"></a>短词负载预测
在能源需求的上下文中，短词负载预测 (STLF) 被指，预计在不久的将来在各个部分的网格 （或作为一个整体网格） 的总负载。 在此情况下，短期内被定义为在 1 小时到 24 小时的范围内的时间范围。 在某些情况下，48 小时内的区间也有可能。 因此，STLF 是网格的很常见操作的用例中。 下面是一些示例的 STLF 驱动的用例︰
-   供需平衡
-   电源贸易支持
-   市场使 （设置电源价格）
-   网格操作优化
-   [请求响应](https://en.wikipedia.org/wiki/Demand_response)
-   峰值需求预测
-   需求侧管理
-   负载平衡和过载保护
-   长期负载预测
-   故障和异常检测
-   峰值 curtailment/调配 

STLF 模型主要是基于接近过去 （最后一天或一周） 消耗数据和使用预测作为重要的预测器的温度。 获得准确的温度预测下一小时和向上 24 小时变得较少的一项挑战现在天。 这些模型是季节性的图案或长期消耗趋势的敏感程度较低。

SLTF 解决方案也有可能产生大量的预测调用 （请求提供服务） 因为他们正在调用在每小时的基础上，并在某些情况下甚至具有更高的频率。 它也是非常常见的实现，其中每个单独的变电所或变压器由独立模型，因此预测请求量会更大。

#### <a name="long-term-load-forecasting"></a>长期负载预测
目标的长词负载预测 (LTLF) 是为多个月份 （和在某些情况下的数年）--从 1 周时间范围与预测能力的要求。 此范围的范围主要是适用于规划和投资使用情况。

对于长期的方案，是一定要有高质量的数据，涵盖范围的多个年份 （最少 3 年）。 这些模型通常将从历史数据中提取季节模式和利用外部 predicators 等与天气和气候模式。

很重要澄清，更长的时间地平线的预测是，预测可能不太准确。 因此务必产生实际预测，使人们考虑到其规划过程可能的变化这一因素以及一些信心间隔。

由于大部分规划 LTLF 的消耗情况，我们可以认为更低的预测卷 （相比 STLF)。 我们通常会看到这些嵌入的可视化工具，如 Excel 或 PowerBI 的预测，并由用户手动调用。

### <a name="short-term-vs-long-term-prediction"></a>长与短词术语预测
下表比较 STLF 和 LTLF 相对于最重要的特性︰

|属性|短期内负载预测|长期负载预测|
|---|---|---|
|预测范围|从 1 小时到 48 小时|从 1 到 6 个月或更多|
|数据粒度|每小时|每小时或每日|
|典型用例|<ul><li>平衡需求/供应</li><li>选择工时预测</li><li>请求响应</li></ul>|<ul><li>长期规划</li><li>网格资源规划</li><li>资源计划</li></ul>|
|典型的预测值|<ul><li>每天或每周</li><li>一天一小时</li><li>每小时温度</li></ul>|<ul><li>年份中的月份</li><li>每月天数</li><li>从长远来看温度和气候</li></ul>|
|历史数据区域|两到三年积累的数据|五至 10 多年积累的数据|
|典型的准确性|映射 * 5%或更低|映射 * 25%或更低|
|预测的频率|每隔一小时或每 24 小时生成|生产后每月、 季度或年|
\*[映射](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error)--平均平均百分比错误

从该表中可看出，它是区分短期和长期预测方案，因为这些代表不同的业务需要，可能有不同的部署和消耗模式非常重要。

### <a name="example-use-case-1-esmart-systems--overload-optimization"></a>示例使用案例 1: eSmart 系统 – 重载优化
[智能网格](https://en.wikipedia.org/wiki/Smart_grid)的一个重要作用是动态不断优化和调整的不断变化的消耗模式。 主要由所导致的 （*例如*，更多电源用于空气条件或加热） 的温度波动的短期更改可能影响功率消耗。 同时，能源消耗也受长期趋势。 这些可能包括季节性效果、 法定假日、 长期消耗增长和甚至经济因素，如使用者索引、 石油价格和 GDP。

在这一使用情形， [eSmart](http://www.esmartsystems.com/)想要部署一个基于云的解决方案，使预测在任何给定的变电所的重载情况下的网格仍然。 特别是，eSmart 希望能够识别可能因此无法采取即时措施避免或解决这种情况下一小时，在重载的 substations。

准确和快速执行预测需要三种预测模型的实现︰
-   长时间期限模型，使预测在下几周或几个月期间在每个变电所功率消耗的
-   短期内模型，使预测在给定变电所期间播映的重载情况下
-   提供对多个方案的未来温度预测的温度模型

长期模型的目标是通过重载 （给定其电源传输容量） 在下一周或月期间他们仍然排名 substations。 这使得可以创建将作为输入进行短期预测的 substations 的候选名单。 温度是重要的预测值为长期模型，是需要不断地产生多方案温度预测和换它们作为为长期模型的输入。 然后调用短期预测预测哪些变电所很可能下一小时通过重载。

每个变电所每单独部署的短期和长期的模型。 因此，这些模型的实际执行将需要广泛的业务流程。 若要在短期内获得较高的预测精度，更精确的模型致力每小时的一天。 所有这些模型执行的每隔一小时和执行要留出足够的时间响应，并根据需要采取预防措施，几分钟内完成。 此集合的模型是通过定期再培训使用最新的数据保持最新。

找不到有关该用例的详细信息[在此处](https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=18945)。

#### <a name="use-case-qualification-criteria--prerequisites"></a>使用系统必备组件的案例资格条件 –
Cortana 智能的主要优势是其部署和扩展机器学习为中心的解决方案的强大能力。 它旨在支持数千个并发执行的预测。 它可以自动扩展以满足不断变化的消耗模式。 解决方案的重点因此，是准确性和计算性能。 例如，公用事业公司有兴趣产生准确的能耗需求预测在下一个小时和一天中的每个小时。 另一方面，我们不太感兴趣的是回答问题的需求预测是因为它是 （模型本身将负责的）。

因此，它是一定要认识到，并非所有使用用例和业务问题能够得到有效地解决使用机器学习。

Cortana 智能和机器学习可能是高效解决给定的业务问题，当满足以下条件︰
-   手中的业务问题是**预测性**本质。 预防性使用案例示例是想要在下一个小时内预测给定变电所上的电源负载是公用事业公司。 另一方面，分析和分级的历史需求的驱动程序应该是**描述性**性质，因此不太适用。
-   没有清晰的**操作路径的**可预测一旦采取。 例如，预测期间播映在变电所重载可以触发减少与该变电所的负载，从而有可能避免重载的主动行动。
-   用例表示一种**典型类型问题的**这类题是当可铺平了为解决其他类似的用例。
-   客户可以设置演示解决方案成功实施的**定量和定性目标**。 例如，能源需求预测的良好定量目标应该要求的精确性阈值 （*例如*，允许最多 5%错误） 或当预测变电所然后重载 （真阳性率） 的精度和召回 （真阳性程度） 应超过给定的阈值。 这些目标应该从客户的业务目标。
-   没有清除**集成方案**与公司的业务流程。 例如，变电所负载预测可以集成到网格控制中心，允许重载预防活动。
-   客户已准备好使用**具有足够的质量数据**以支持用例 （参见下一节，**数据质量**，本操作手册的更多）。
-   客户涵盖云数据中心体系结构或**基于云的机器学习**，包括 Azure ML 和其他 Cortana 智能套件组件。
-   客户不愿意建立该设施的**端到端数据流**数据传递到不断，云并将愿意**实施**该解决方案。
-   客户程序准备**专门的资源**将会积极参与对初始试验实施过程，使可于成功完成时客户传输知识和解决方案的所有权人。
-   客户资源应该是**经验丰富的专业数据**，最好是科研人员的数据。

用例根据上述标准限定可以极大地提高用例的成功率，建立好 beachhead 为将来使用用例的实现。

### <a name="cloud-based-solutions"></a>基于云的解决方案
在 Azure 上的 Cortana 智能套件是驻留在云环境中的集成的环境。 在云环境中的高级分析功能解决方案部署拥有实实在在的好处，为企业，并在同一时间可能意味着重大更改仍然使用后端 IT 解决方案的公司。 在能源部门中，还有逐步迁移到云环境的操作的明显趋势。 这一趋势息息相关的以及开发的智能网格中所述，上述**行业发展趋势**。 本操作手册的重点是能源域中的基于云的解决方案，因为务必要解释的优点和部署一个基于云的解决方案的其他注意事项。

也许是解决方案的一个基于云的最大优点是解决方案的成本。 作为一种解决方案利用云部署的组件没有任何前期成本或与之相关联的已售商品成本 （所售货物成本） 组件成本。 这意味着不需要投资购买硬件、 软件和 IT 维护，因此它可以大大降低业务风险。

另一个重要优点是基于云的解决方案的使用付费的成本结构。 可以部署和扩展需要只是基于云计算或存储的服务器。 这是解决方案的一个基于云的成本效率优势。

最后，是解决方案的因为所有这些都基于云的一部分投资于 IT 维护或未来的基础结构开发不需要。 该范围内，Cortana 智能套件类服务中包括最佳和保持发展的路线图。 新功能、 组件和功能不断引入和发展。

对于刚刚启动其过渡到云一家公司，我们强烈推荐通过实施云迁移路线图采取一种逐步的方法。 我们认为对于实用工具和能量域中的公司，本操作手册所述的用例表示对试运行在云中的预测分析解决方案的很好机会。

#### <a name="business-case-justification-considerations"></a>业务案例论证注意事项
在许多情况下，客户可能有兴趣做一个基于云的解决方案和机器学习是重要的组成部分一个给定的用例的业务理由。 与后端的解决方案，在基于云的解决方案中，不同的前期成本组件是最小和成本要素的大多数都是与实际使用情况。 当部署预测解决方案 Cortana 智能套件在能源方面时，则可以与单个常见的成本结构集成多个服务。 例如，数据库 （*例如*，SQL Azure） 可以用于存储的原始数据，然后实际预测 Azure ML 用于承载预测服务。 在此示例中，存储和事务性组件可能包括成本结构。

另一方面，应具备操作能源需求预测 （长期或短期的术语） 的商业价值更好地理解。 事实上，它是一定要认识到每个预测操作的业务价值。 例如，准确地预测下一个 24 小时的电源负载是可以防止 overproduction 或可以帮助防止在网格上的重载，这可量化方面每天节约了成本。

用于计算需求的财务优势基本公式预测的解决方案是︰![基本公式用于计算需求的财务收益预测的解决方案](media/cortana-analytics-playbook-demand-forecasting-energy/financial-benefit-formula.png)

因为 Cortana 智能套件提供了随增长付费的定价模型，所以也会招致此公式的固定的成本组件不需要。 此公式可以计算在每日、 每月或每年的基础上。

当前的 Cortana 智能套件和 Azure ML 定价计划可以找到[这里](http://azure.microsoft.com/pricing/details/machine-learning/)。

### <a name="solution-development-process"></a>解决方案开发过程
基于云的技术和服务 Cortana 智能套件中的使用预测解决方案通常涉及 4 阶段，在所有这些中，我们将使能源需求的开发周期。

下图所示︰

![智能网格周期](media/cortana-analytics-playbook-demand-forecasting-energy/smart-grid-cycle.png)

下面的段落描述了这 4 个步骤︰

1.  **数据收集**— 任何高级分析功能基于解决方案依赖于数据 （请参见**数据了解**）。 特别是，预测分析和预测时，我们依靠的持续、 动态数据流。 在能源需求预测，此数据可以直接从智能米，源于或已聚合 prem 在数据库上。 我们还依赖于其他外部数据源的天气和温度等。 必须统一协调、 计划和保存这个日常流量的数据。 [Azure 数据工厂](http://azure.microsoft.com/services/data-factory/)(ADF) 是用于完成此任务我们主的健将。
2.  **建模**--的准确和可靠的能源预测，其中一个必须开发 （火车） 和维护很好的模型，使历史数据的使用和提取数据中的有意义和预测模式。 区域中的机器学习 (ML) 迅速发展，与正在例行地开发更高级的算法。 Azure ML Studio 提供出色的用户体验，可以帮助利用最先进的 ML 算法，完成工作流中。 该工作流直观的流图所示，包括数据准备、 特征提取、 建模和模型评估。 用户可以吸引数以百计的包含在此环境中的各种模型。 这一阶段结束数据科学家必须充分评估和部署准备工作就绪的工作模型。

    下面的关系图演示了执行的典型工作流︰

    ![建立工作流模型](media/cortana-analytics-playbook-demand-forecasting-energy/modeling-workflow.png)

3.  **部署**– 与工作模型在手下, 一步是部署。 此模型将转换为公开一个 rest 风格的 API，可以通过互联网与各种消耗客户端同时调用的 web 服务。 Azure ML 提供部署模型直接从 Azure ML 工作室通过一次单击一个按钮的简单的方法。 整个部署过程发生在汽车发动机罩下。 此解决方案可以自动扩展以满足所需的工作量。

4.  **消耗量**– 在此阶段中，我们才进行实际使用的预测模型产生的预测。 消耗可从用户应用程序 （*例如*，仪表板） 驱动或直接从如运营系统需求/供应平衡系统或网格的优化解决方案。 可从单个模型驱动多个使用案例。

## <a name="data-understanding"></a>数据了解
之后涵盖能源需求预测解决方案业务方面 （请参见**业务了解**），我们现在可以讨论的数据部分。 任何预测分析的解决方案依赖于可靠的数据。 对于能源需求预测，我们依靠过去的消耗数据与各种粒度级别。 历史数据可作为原材料。 它将经过仔细分析数据科学家识别 （也称为功能），可放入这最终将生成所需的预测模型的预测值。

本节的其余部分，我们将描述的各个步骤和理解数据以及如何将它放到一个可用的窗体时的注意事项。

### <a name="the-model-development-cycle"></a>在模型的开发周期
制作好的预测模型需要一些经过精心准备和规划。 细分建模过程分为多个步骤，一步一次集中检查可以极大地提高整个过程的结果。

下图说明了如何建模过程可以分为多个步骤︰

![模型开发周期](media/cortana-analytics-playbook-demand-forecasting-energy/model-development-cycle.png)

可看出周期包含六个步骤︰
-   问题表述
-   数据提取和数据开采
-   准备数据和功能工程
-   建模
-   模型计算
-   开发

本节的其余部分将描述的各个步骤和事项需要注意，每一步。

### <a name="problem-formulation"></a>问题表述
我们可以考虑问题制定作为一个需要实现任何预测分析的解决方案之前采取的最重要一步。 这里我们将转换的业务问题并将它分解为特定元素可以通过使用数据和建模技术加以解决。 它是很好的做法，来制定作为一组问题，我们想要回答的问题。 下面是一些可能的能源需求预测范围内适用的可能问题︰
-   在下一个小时或一天是各个变电所的预期的负载什么？
-   在一天中的什么时候将我的网格会遇到高峰需求？
-   可能性有多大是我的网格以维持预期的高峰负载？
-   电源站在一天中的每个小时期间应生成多少能源？

系统地阐明这些问题，我们可以集中精力获取正确的数据，并实现一个完全符合手头的业务问题的解决方案。 此外，我们就可以设置一些使我们能够评估模型的性能的关键指标。 例如，如何准确预测应和的仍然是通过业务可接受的误差范围是什么？

### <a name="data-sources"></a>数据源
现代智能网格从各种部件和组件在网格中收集数据。 这些数据表示操作的各个方面和电源网格的利用率。 在能源需求预测的范围内，我们将限制反映实际需求消耗的数据源上的讨论。 能源消耗的一个重要来源是智能米。 实用程序在全球范围内的消费者迅速部署智能米。 智能米记录的实际电源消耗和不断中继此数据回发到公用事业公司。 收集数据并将其发送回以固定时间间隔，范围从每隔 5 分钟到 1 小时。 更高级的智能米可远程编程控制和平衡在家庭内的实际消耗量。 智能计量数据相当可靠，并包含一个时间戳。 这使得它的需求预测的重要因素。 计量器聚合数据 （求和） 网格拓扑内不同级别︰*变压器、 变电所、 区域等*。然后我们可以选择要为其生成预测模型所需的聚合级别。 例如，如果公用事业公司想要预测未来在其网格 substations 的每个负载然后所有米数据可以被汇总为每个单独的变电所和作为输入用于预测模型。 我们请参阅智能米作为内部数据源。

可靠的能源需求预测还将依赖于其他外部数据源。 影响功率消耗的一个重要因素是天气或更精确的温度。 历史数据显示外部温度和电源消耗之间的强相关性。 在盛夏天期间消费者建立使用空调和期间的冬季电加热系统。 因此，可靠的来源的历史中的网格位置温度是关键。 此外，我们还依赖于温度的准确预测作为能源消耗的预测值。

在构建能源需求预测的模型，还可以帮助其他外部数据源。 这些可能包括长期气候的更改、 经济索引 （*例如*，GDP），和其他人。 在本文中我们将不包含这些其他数据源。

### <a name="data-structure"></a>数据结构
在确定后所需的数据源，我们想要确保已收集的原始数据中包括正确的数据功能。 若要生成可靠的需求预测的模型，我们需要确保收集的数据，包括数据元素，可以帮助预测将来的需求。 以下是一些有关原始数据的数据结构 （架构） 的基本要求。

原始数据由行和列组成。 每个度量值表示为单个行的数据。 每个数据行包含多个列 （也称为功能或域）。

1.  **时间戳**— 时间戳字段表示记录测量时的实际时间。 它应该符合一种常见的日期/时间格式。 日期和时间部分应包括。 在大多数情况下，没有需要时间来记录之前第二等级。 请务必指定时区中的记录数据。
2.  **计量器 ID** -此字段标识计量或测量设备。 它是某一分类变量，可以是数字和字符的组合。
3.  **消耗值**— 这是在给定的日期/时间表示的实际消耗量。 消耗量可以以千瓦时 （千瓦时） 或任何其他首选单位。 值得注意的度量单位，必须在数据中的所有度量值保持一致。 在某些情况下，消耗可以提供超过 3 电源阶段。 在这种情况下，我们需要收集所有独立的消耗量阶段。
4.  **温度**– 温度通常是从独立来源收集的。 但是，它应与消耗数据兼容。 它应包括将允许它与实际消耗量数据同步的时间戳按上文所述。 温度值中度摄氏或华氏温度均可指定，但是跨所有量化指标应保持一致。
5.  **位置 –**位置字段是通常与已收集到的温度数据的位置。 它可以表示为一个 zip 代码编号或纬度/经度 （纬度/经度） 格式。

下表显示了良好的功耗和温度的数据格式的示例︰

|**日期**|**时间**|**计量器 ID**|**第 1 阶段**|**第 2 阶段**|**第 3 阶段**|
|--------|--------|------------|-----------|-----------|-----------|
|2015 年 7/1|10:00:00|ABC1234     |7.0        |2.1        |5.3        |
|2015 年 7/1|10:00:01|ABC1234     |7.1        |2.2        |4.3        |
|2015 年 7/1|10:00:02|ABC1234     |6.0        |2.1        |4.0        |

|**日期**|**时间**|**位置**|**温度**|
|--------|--------|-------------|---------------|
|2015 年 7/1|10:00:00|11242        |24.4           |
|2015 年 7/1|10:00:01|11242        |24.4           |
|2015 年 7/1|10:00:02|11242        |24.5           |

上述中可看出，该示例包括消耗 3 电源阶段相关联的三个不同的值。 此外，分隔日期和时间字段，但是它们也可以组合到单个列。 在这种情况下位置列中的 5 位数字的邮政编码格式和温度以摄氏度的格式表示。

### <a name="data-format"></a>数据格式
Cortana 智能套件可以支持的最常见的数据格式，如*CSV、 TSV、 JSON 等*。请务必在项目的整个生命周期的数据格式保持一致。

### <a name="data-ingestion"></a>数据提取
由于能源需求预测不断地、 频繁地预测，我们必须确保原始数据流动通过稳定、 可靠的数据接收过程。 接收进程必须保证原始数据可用于预测过程在所需的时间。 这意味着数据摄取频率应大于预测的频率。

例如︰ 如果预测解决方案我们需要将生成新的预测，在每天上午 8:00，那么我们需要确保所有在过去 24 小时期间收集到的数据之前该点已完全 ingested，甚至包含数据的最后一个小时。

为了做到这一点，Cortana 智能套件提供支持可靠的数据接收过程的各种方式。 这将在本文档的**部署**部分中进一步讨论。

### <a name="data-quality"></a>数据质量
对于执行可靠和准确的需求预测是必需的原始数据源必须满足一些基本的数据质量标准。 虽然可以使用高级统计方法来弥补某些可能的数据质量问题，但我们仍然需要确保接收新数据时我们会越过一些基本数据质量阈值。 以下是有关原始数据质量的几个注意事项︰
-   **缺少值**--这指的是这种情况不收集特定度量值时。 基本要求是，缺少值率不应超过 10%为任何给定的时间段。 在用例中单个值缺少它应指出使用预定义的值 (例如:"9999") 而不可能是有效的度量单位的 ' 0'。
-   应准确记录**测量准确性**– 实际值的消耗或温度。 不准确的测量结果将产生不准确的预测。 通常情况下，测量错误应该低于 1%，相对于真值。
-   **时间的测量**– 需要实际的时间戳的数据收集将不可偏离按相对于实际测量的真实时间超过 10 秒。
-   **同步**— 当正在使用多个数据源 （*例如*，功耗和温度） 我们必须确保它那里是没有时间同步问题两者之间。 这意味着任何两个独立的数据源收集时间戳之间的时间差别不应超过 10 秒钟以上。
-   **滞后时间**--如上所述，在**数据接收**，我们都依赖于可靠的数据流量和接收过程。 对，我们必须确保我们控制数据滞后时间的控制。 此值指定为拍摄实际测量的时间和在它已加载到存储的 Cortana 智能套件并可供使用的时间之间的时差。 对于短期内的负载预测总滞后时间不应超过 30 分钟。 对于长期负载预测总滞后时间不应超过 1 天。

### <a name="data-preparation-and-feature-engineering"></a>准备数据和功能工程
原始数据已被 ingested （请参见**数据提取**） 并已被安全地存储后，就可以进行处理。 数据准备阶段基本上是采用的原始数据和转换 （转换，改变形状） 到建模阶段的窗体。 它可能包括简单的操作，如使用的原始数据列，与实际测量的值、 标准化的值、 更复杂操作，如[时间滞后](https://en.wikipedia.org/wiki/Lag_operator)，和其他人一样。 新创建的数据列被称为数据功能和生成这些的过程被称为功能的工程。 通过此过程结束时，我们必须新的数据集，从原始数据，并可用来进行建模。 此外，数据准备阶段需要小心缺少的值 （请参见**数据质量**） 并补偿他们。 在某些情况下，我们还需要进行正态化的数据，以确保所有的值都以相同的比例。

在本节中，我们列出了一些常见的数据特征，包括在能源需求预测模型。

**驱动功能的时间︰**这些功能被派生自的日期/时间戳数据。 这些都是提取，转换为分类的功能，如︰
-   时间一天--这是采用值为从 0 到 23 日的 24 小时
-   一天一周 – 这表示一周中的第一天，接受值为从 1 （星期日） 到 7 （星期六）
-   一天的月 – 这表示实际日期，可以从 1 到 31 之间的值
-   月的年 – 这表示月份，接受值为从 1 （一月） 为 12 （12 月）
-   周末--这是所需的值为 0 工作日或 1 为周末的二进制值功能
-   节日-这是节日的一正则天或 1 采用的值为 0 的二进制值功能
-   傅立叶条款 – 傅立叶条款是在数据权重将时间戳从派生，用于捕获季节 （时钟周期数）。 因为我们在我们的数据中可能有多个季节我们可能需要多个傅立叶术语。 例如，请求值可能具有每年、 每周和每日季节/周期从而将产生 3 傅立叶条款。

**独立测量功能︰**独立的功能包括我们要将作为我们的模型预测值的所有数据元素。 这里我们不依赖功能，我们需要预测。
-   延隔时间功能--这些都是移动的时间值的实际需求。 例如，滞后 1 功能将保留请求值，在相对于当前时间戳 （假定每小时的数据） 的前一个小时。 同样，我们可以添加延迟 2，落后 3，*等等*。在建模阶段，模型结果的评估是已确定延迟功能所使用的实际结合。
-   长期趋势 — 此功能表示的年需求量也呈线性增长。

**依赖功能︰**相关的功能是我们想要我们的模型进行预测的数据列。 与[监察的机器学习](https://en.wikipedia.org/wiki/Supervised_learning)，我们需要首先训练使用从属特征的模型 （这也称为标签）。 这使得模型学习与依存功能关联的数据中的模式。 在能源需求预测我们通常想要预测的实际需求，因此我们会将其用作从属特征。

**处理缺少的值︰**在数据准备阶段中，我们将需要确定处理缺失值的最佳战略。 这主要通过使用各种统计[数据 imputation 方法](https://en.wikipedia.org/wiki/Imputation_(statistics))。 在能源需求预测，我们通常使用移动平均从以前可用的数据点 impute 缺少的值。

**数据规范化︰**数据规范化是另一种用来使所有的数字型数据，例如销售预测类似的尺度转换。 这通常有助于提高模型的准确性和精度。 我们通常会执行此操作实际值除以数据的范围。
这将缩小到较小的范围内，通常介于-1 和 1 之间规模的原始值。

## <a name="modeling"></a>建模
在建模阶段是到模型的转换数据的发生。 在此过程存在的核心被高级扫描历史数据 （培训），提取模式，并构建模型的算法。 可以稍后使用该模型预测上有不被用于构建模型的新数据。

一旦我们有一个工作可靠模型，我们就可以使用它得分结构以包括所需的功能 (X) 的新数据。 计分过程将使用的持久模型 （从培训阶段的对象） 并预测由 Ŷ 表示目标变量。

### <a name="demand-forecasting-modeling-techniques"></a>需求预测建模技术
在需求预测我们作出的情况下使用的历史数据按时间排序。 我们通常是指包含时间维度为[时间序列](https://en.wikipedia.org/wiki/Time_series)的数据。 时间序列建模的目标是要找到时间相关的趋势、 季节，自动关联 （随时间变化的相关性），并阐明那些引入模型。

近几年高级的算法已开发以适应的时间序列预报，并提高预测的准确性。 我们简要讨论了几个例子。

> [AZURE.NOTE] 本节不适用于作为机器学习和预测概述而是而是作为一个简短调查的建模技术，通常用于需求预测。 有关详细信息和有关的时间序列预报的教育资料，我们极力建议联机图书[预测︰ 原则和实践](https://www.otexts.org/book/fpp)。

#### <a name="ma-moving-averagehttpswwwotextsorgfpp62"></a>[**MA （移动平均）**](https://www.otexts.org/fpp/6/2)
移动平均线是一个第一的分析技术，已用于时间序列预报，最好仍是一种最常用的截至今天的技术。 也是的基础，对于更高级的预测技术。 使用移动平均我们平均 K 最新点，其中 K 表示移动平均的顺序上预测的下一个数据点。

移动平均方法的平滑预测的效果，因此可能不会处理数据中的也有较大波动性。

#### <a name="ets-exponential-smoothinghttpswwwotextsorgfpp75"></a>[**ETS （指数平滑）**](https://www.otexts.org/fpp/7/5)
指数平滑 (ETS) 是一系列的各种方法来预测下一步的数据点使用新数据点的加权的平均值。 目的是为较新的值分配更高的重量，逐渐减小此重量较旧的测量值。 有多种不同的方法与本族，其中的一些如[兵威 Winters 季节性方法](https://www.otexts.org/fpp/7/5)的数据中包括处理的季节。

这些方法还考虑数据的季节。

#### <a name="arima-auto-regression-integrated-moving-averagehttpswwwotextsorgfpp8"></a>[**ARIMA （自动回归集成移动平均值）**](https://www.otexts.org/fpp/8)
自动回归集成移动平均 (ARIMA) 是通常用于时间序列预测的另一系列的方法。 实际上，它将自动回归方法合并使用移动平均。 自动回归方法来计算下一个日期点采用以前的时间系列值使用回归分析模型。 ARIMA 方法还应用差异比较的方法，包括计算数据点之间的差异，以及使用它们而不是原始的测量值。 最后，ARIMA 还使用上面讨论的移动平均技术。 所有这些方法的各种方式的组合是什么构造的 ARIMA 方法系列。

ETS 和 ARIMA 被广泛用于目前能源需求预测和许多其他的预测问题。 在许多情况下这些组合在一起以提供非常准确的结果。

**一般多回归**回归模型可能是最重要的建模方法，在机器学习和统计数据的域中。 时间序列的上下文中我们使用回归来预测未来的值 （*例如*，需求的）。 在回归分析中，我们会预测值的线性组合并在培训过程中了解这些预测值的权重 （也称为系数）。 目标是生成将预测我们预测的值回归直线。 当目标变量为数字，因此还适合的时间序列预报，回归方法都适用。 没有广泛的回归分析方法，包括[线性回归](https://en.wikipedia.org/wiki/Linear_regression)等的非常简单的回归分析模型和决策树、[随机林](https://en.wikipedia.org/wiki/Random_forest)、[神经网络](https://en.wikipedia.org/wiki/Artificial_neural_network)和提升决策树等更高级的。

建立能源需求预测是回归问题为我们提供了很大的灵活性，从实际需要的时间序列数据和外部因素，如温度选择我们的数据功能，可以将它们组合起来。 工程 （请参见**数据准备和工程设计功能**） 节本操作手册的特征讨论了有关安装所选功能的详细信息。

从我们与实施和部署的能源需求预测试点的经验，我们发现位于 Azure ML 的高级的回归模型往往会得到最好的结果，我们会使用它们。

## <a name="model-evaluation"></a>模型计算
模型计算具有**模型开发周期**内的重要角色。 在此步骤中，我们介绍到验证模型和它的性能与实际数据。 在建模阶段我们培训模型使用的可用数据的一部分。 在评估阶段中，我们将采取的数据来测试模型的其余部分。 实际上，这意味着我们进模型新的数据已重新构造，并包含培训数据集与相同的功能。 但是，在验证过程中，我们使用模型来预测目标变量，而不是提供可用的目标变量。 我们通常称此过程作为模型评分。 然后将使用真正的目标值，较预测的对它们进行比较。 这里的目标是度量并最小化的预测错误，即预测与真实值之间的差异。 量化错误测量是关键，因为我们想要优化模型，并验证是否实际上减少了错误。 可以通过修改模型参数，控制学习过程中，或通过添加或移除数据功能 （称为[参数扫描](https://channel9.msdn.com/Blogs/Windows-Azure/Data-Science-Series-Building-an-Optimal-Model-With-Parameter-Sweep)） 进行微调模型。 实际上这意味着，我们可能需要循环之间功能的工程设计，建模，以及模型评估阶段多次，直到我们都能够将错误减少到所需级别。

值得强调的预测错误永远不会零作为不完全可以预测每个结果的模型。 但是，还有某些程度是由业务可接受的错误。 在验证过程中，我们希望确保我们模型的预测错误的级别或优于业务容差级别。 因此务必将容许错误的级别设置**问题制定**阶段周期的开始。

### <a name="typical-evaluation-techniques"></a>典型的求值技术
有多种方法中的预测错误是可以衡量和量化。 在本节中，我们将重点放在相关时间序列以及在特定的能源需求预测计算方法的讨论。

#### <a name="mapehttpsenwikipediaorgwikimeanabsolutepercentageerror"></a>[**映射**](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error)
映射表示意味着绝对百分比错误。 我们将使用映射计算之间的差异点，该点实际值每个预测。 然后，我们通过计算相对于实际值的差额的比例量化每个点的错误。 最后一步，我们平均这些值。 用于映射的数学公式是如下︰

![映射公式](media/cortana-analytics-playbook-demand-forecasting-energy/mape-formula.png)
*其中<sub>t</sub>是实际值、 F<sub>t</sub>是预测的值，n 是预测的区间。*

## <a name="deployment"></a>部署
一旦我们有确定的建模阶段，验证模型性能我们准备进入部署阶段。 在此上下文中，部署意味着使客户通过运行在其上进行大规模的实际预测消耗模型。 部署的概念是在 Azure ML 的关键，因为我们主要的目标是不断调用而不是仅从数据中获取真知灼见的预测。 在部署阶段是部分实现模型在大规模消耗的地方。

在能源需求预测的上下文中，我们的目标是要确保最新的数据是可用于模型和预测的数据发送回使用客户端同时调用持续和定期预测。

### <a name="web-services-deployment"></a>Web 服务部署
主要的可部署构建基块在 Azure ML 是 web 服务。 这是最有效的方法，为了能在云中的预测模型。 Web 服务封装模型，并总结了使用[RESTful](http://www.restapitutorial.com/) API （应用编程接口）。 API 可以用作任何客户端代码，如下面的关系图中所示的一部分。

![我们的服务部署和消耗](media/cortana-analytics-playbook-demand-forecasting-energy/web-service-deployment-and-consumption.png)

可看出，web 服务被部署在 Cortana 智能套件云，可以在其公开的 REST API 端点调用。 另一种跨各种域客户端可以同时调用通过 Web API 服务。 Web 服务还可以扩展以支持数千个并发调用。

### <a name="a-typical-solution-architecture"></a>典型的解决方案体系结构
在部署时的能源需求预测的解决方案，我们有兴趣部署端到端解决方案，超出预测的 web 服务，并且便于整个数据流。 我们调用新的预测时，我们将需要确保模型纸具有最新的数据的功能。 这意味着，新收集到的原始数据是不断 ingested、 处理，并转换为模型的构建上设置所需的功能。 同时，我们希望使用客户端提供的预测的数据。 下图说明了示例数据流量周期 （或数据管道）︰

![能源需求预测的端到端数据流动](media/cortana-analytics-playbook-demand-forecasting-energy/energy-demand-forecase-end-data-flow.png)

这些是作为能源需求预测周期的一部分执行的步骤︰
1.  数以百万计的已部署的数据米不断实时生成电源消耗数据。
2.  这些数据被收集并上载到云存储库 （*例如*，Azure Blob）。
3.  在处理之前的原始数据进行聚合到变电所或地区级别所定义的业务。
4.  然后进行功能处理的 （请参见**数据准备和处理功能**） 并生成所需的数据模型培训或评分 — — 功能集数据存储在数据库中 （*例如*，SQL Azure）。
5.  重新培训服务调用来重新训练预测模型，模型的更新的版本保持不变，以便它可以由计分的 web 服务。
6.  计分的 web 服务调用上符合预测的所需的频率的计划。
7.  最终消耗客户端可以访问数据库中存储的预测的数据。
8.  消耗客户端检索预测，将其应用到网格中，并按照所需的用例中使用它。

请务必注意，整个周期完全自动化的按计划自动运行。 可以通过使用[Azure 数据工厂](http://azure.microsoft.com/services/data-factory/)等工具完成此数据周期的整个业务流程。

### <a name="end-to-end-deployment-architecture"></a>端到端部署体系结构
为了切实部署在 Cortana 智能能源需求预测的解决方案，我们需要确保建立并正确配置所需的组件。

下图说明一个典型基于 Cortana 智能体系结构，实现和协调上述的数据流量周期︰

![端到端部署体系结构](media/cortana-analytics-playbook-demand-forecasting-energy/architecture.png)

有关每个组件和整个体系结构的详细信息请参阅能源解决方案模板。

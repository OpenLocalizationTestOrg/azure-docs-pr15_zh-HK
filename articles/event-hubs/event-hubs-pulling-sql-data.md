<properties
   pageTitle="将 SQL 数据获取到 Azure 事件集线器 |Microsoft Azure"
   description="从 SQL 示例导入事件集线器的概述"
   services="event-hubs"
   documentationCenter="na"
   authors="spyrossak"
   manager="timlt"
   editor=""/>

<tags 
   ms.service="event-hubs"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="08/25/2016"
   ms.author="spyros;sethm" />

# <a name="pulling-data-from-sql-into-an-azure-event-hub"></a>将数据从 SQL 获取到 Azure 事件中心

典型的体系结构，用于处理实时数据的应用程序涉及到第一次将其推到 Azure 事件中心。 它可能 IoT 方案，如监视在不同拉伸的一条高速公路上的通信量或游戏方案中，由于选手，许多的操作监视或企业方案，如监视构建占有。 在这些情况下，数据生产者通常外部产生时间序列数据的收集、 分析、 存储，您需要的对象，并且在法案时，也可能投入了大量的精力到这些过程的基础结构构建。 什么做您如果您想要将数据导入从内容数据库，而不是源的流数据，像和配合使用其他流数据？ 考虑要使用 Azure 流分析、 远程数据资源管理器 (RDX) 或某些其它工具来进行分析并采取从 AX 缓慢地更改数据或自定义的设施管理系统上的情况吗？ 若要解决此问题，我们已经编写并开放源代码的小的云，您可以修改和部署示例，该示例将拉 SQL 表中的数据并将其推到 Azure 事件中心作为下游分析应用程序中输入使用。 请记住，这是少见的方案，并与您通常做什么事件中枢。 但是，如果您找到了自己在这种情况下您需要做什么，您可以在 Azure 样本库，[这里](https://azure.microsoft.com/documentation/samples/event-hubs-dotnet-import-from-sql/)找到代码。  

请注意，此示例中的代码就是一个示例。 它是**不是一个生产应用程序中，**并没有尝试以使其适合用于在这样一个环境-它 stricly DIY，专注于开发人员的示例。 您需要检查各种类型的安全性、 性能、 功能和前安定在一个端到端体系结构的成本因素。

## <a name="application-structure"></a>应用程序结构

在 C# 中，编写应用程序，该示例中的 readme.md 文件包含要修改、 构建和发布应用程序所需的所有信息。 以下各节提供了应用程序的高级别概述。

我们首先假设您有权访问 SQL Azure 表。 您还需要设置 Azure 的事件集线器，并且知道连接字符串需要对其进行访问。

SqlToEventHub 解决方案启动时，它会读取一个配置文件 (App.config) 能够做许多事情，在 readme.md 文件中所述。 这些是无需解释，如数据表等的名称，就不需要再重复说明此处。 

一旦应用程序已读取配置文件，它转进入循环，读取 SQL 表记录推向事件中心，然后执行之前它从头再次等待用户定义睡眠间隔。 几件事情是值得注意︰

1. 应用程序基于 SQL 表更新某些外部进程，并且您想要发送所有的假设和只对事件中心的更新。
2. SQL 表需要有一个独特和日益增长的数字，例如，记录号码的字段。 这很简单，只需一个名为"Id"字段或其他任何增加作为任何更新该数据库中添加记录，如"Creation_time"或"Sequence_number"。 应用程序说明，并将该字段的值存储在每个迭代中。 在循环的每个后续阶段，应用程序本质上是查询表它看到最后一次执行循环时，该字段的值超出了值的所有记录。 我们正在调用此最后一个值"偏移量"。
3. 在启动时，存储的偏移量，该应用程序将创建一个表"TableOffsets"。 与"CreateOffsetTableQuery"在配置文件中定义的查询中创建表。 
4. 有几个查询是用来处理与偏移量表，在配置文件中定义为"OffsetQuery"、"UpdateOffsetQuery"和"InsertOffsetQuery"。 不应更改这些。
5. 最后，在配置文件中定义的"DataQuery"的查询是查询将运行 SQL 表中的记录中拉出。 它是当前限制前 1000 位中的记录进行优化的循环通过每个阶段如果，例如，25000 记录已添加到数据库上一次查询，因为它可能需要一些时间来执行查询。 通过每次限制为 1000 个记录的查询，查询是快得多。 选择前 1000 位简单将后续批次的 1000 个记录推送到事件中心。    

## <a name="next-steps"></a>下一步行动

部署解决方案，克隆或 SqlToEventHub 应用程序下载、 编辑的 App.config 文件、 生成，并最后将其发布。 一旦发布应用程序，可以看到它在 Azure 经典门户在云服务下运行并监视来到事件中心的事件。 请注意，频率取决于两件事︰ SQL 表中，以及在配置文件应用程序中指定的睡眠间隔更新的频率。
<properties 
    pageTitle="消息处理异常事件集线器 |Microsoft Azure"
    description="Azure 事件集线器消息异常和建议的操作的列表。"
    services="event-hubs"
    documentationCenter="na"
    authors="sethmanheim"
    manager="timlt"
    editor="" />
<tags 
    ms.service="event-hubs"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="10/14/2016"
    ms.author="sethm" />

# <a name="event-hubs-messaging-exceptions"></a>消息处理异常事件集线器

这篇文章列出了由 Azure 服务总线消息传递 Api 生成一些例外情况。 此 API 集包括事件集线器。 此引用可能会发生更改，因此检查更新。

## <a name="exception-categories"></a>例外类别

消息传递 Api 生成异常，可以分为以下几类，以及相关联的操作，您可以试着解决它们。 请注意，异常的原因和含义可以因消息 （继电器，队列/主题，事件集线器） 的实体的类型︰

1.  编码错误 ([System.ArgumentException](https://msdn.microsoft.com/library/system.argumentexception.aspx)， [System.InvalidOperationException](https://msdn.microsoft.com/library/system.invalidoperationexception.aspx)， [System.OperationCanceledException](https://msdn.microsoft.com/library/system.operationcanceledexception.aspx)， [System.Runtime.Serialization.SerializationException](https://msdn.microsoft.com/library/system.runtime.serialization.serializationexception.aspx)) 的用户。 常规操作︰ 尝试修复之前的代码。

2.  安装/配置错误 （[Microsoft.ServiceBus.Messaging.MessagingEntityNotFoundException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingentitynotfoundexception.aspx)、 [System.UnauthorizedAccessException](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx)。 常规操作︰ 查看您的配置，如果有必要，请更改。

3.  瞬时异常 ([Microsoft.ServiceBus.Messaging.MessagingException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx)， [Microsoft.ServiceBus.Messaging.ServerBusyException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.serverbusyexception.aspx)， [Microsoft.ServiceBus.Messaging.MessagingCommunicationException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingcommunicationexception.aspx))。 常规操作︰ 重试操作或通知用户。

4.  [System.Transactions.TransactionException](https://msdn.microsoft.com/library/system.transactions.transactionexception.aspx)、 [System.TimeoutException](https://msdn.microsoft.com/library/system.timeoutexception.aspx)、 [Microsoft.ServiceBus.Messaging.MessageLockLostException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagelocklostexception.aspx)（ [Microsoft.ServiceBus.Messaging.SessionLockLostException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.sessionlocklostexception.aspx)） 的其他异常。 常规操作︰ 特定异常类型;请参阅下一节中的表。 

## <a name="exception-types"></a>异常类型

下表列出了消息的异常类型及其原因和说明可以采取建议的操作。

| **异常类型**                                                                                                                                                                                                                                                                                | **说明/导致/示例**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | **建议的操作**                                                                                                                                                                                                                                                                                                                                                                                                          | **请注意/即时自动重试**                                                                                             |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| [TimeoutException](https://msdn.microsoft.com/library/system.timeoutexception.aspx)                                                                                                                                                                                                           | 服务器未响应中指定的时间，由[OperationTimeout](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingfactorysettings.operationtimeout.aspx)所请求的操作。 服务器可能已完成请求的操作。 这可能是由于网络或其他基础结构的延迟。                                                                                                                                                                                                                                                                   | 检查系统状态的一致性，如果必要请重试。                                                                                                                                                                                                                                                                                                                                                            | 重试可能有助于在某些情况下;向代码中添加重试逻辑。                                                                      |
| [能反转](https://msdn.microsoft.com/library/system.invalidoperationexception.aspx)                                                                                                                                                                                         | 不允许在服务器或服务请求的用户操作。 异常消息的详细信息，请参阅。 例如，[完成](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.brokeredmessage.complete.aspx)生成此异常，如果在**ReceiveAndDelete**模式下接收消息。                                                                                                                                                                                                                                                                                                     | 检查代码和文档。 请确保所请求的操作无效。                                                                                                                                                                                                                                                                                                                                         | 重试将于事无补。                                                                                                          |
| [OperationCanceledException](https://msdn.microsoft.com/library/system.operationcanceledexception.aspx)                                                                                                                                                                                       | 尝试调用已经关闭，中止或释放的对象上的操作。 在极少数情况下，环境事务已被释放。                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 检查代码，确保它不会调用已释放对象上的操作。                                                                                                                                                                                                                                                                                                                                          | 重试将于事无补。                                                                                                          |
| [UnauthorizedAccessException](https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx)                                                                                                                                                                                     | [TokenProvider](https://msdn.microsoft.com/library/azure/microsoft.servicebus.tokenprovider.aspx)对象无法获取令牌，令牌无效，或标记不包含执行该操作所需的声明。                                                                                                                                                                                                                                                                                                                                                                                                  | 请确保使用正确的值创建标记提供程序。 检查访问控制服务的配置。                                                                                                                                                                                                                                                                                                   | 重试可能有助于在某些情况下;向代码中添加重试逻辑。                                                                      |
| [ArgumentException](https://msdn.microsoft.com/library/system.argumentexception.aspx)<br /> [ArgumentNullException](https://msdn.microsoft.com/library/system.argumentnullexception.aspx)<br />[ArgumentOutOfRangeException](https://msdn.microsoft.com/library/system.argumentoutofrangeexception.aspx) | 向方法提供的一个或多个参数是无效的。 URI 提供给[NamespaceManager](https://msdn.microsoft.com/library/azure/microsoft.servicebus.namespacemanager.aspx)或[创建](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingfactory.create.aspx)包含路径段。 提供给[NamespaceManager](https://msdn.microsoft.com/library/azure/microsoft.servicebus.namespacemanager.aspx)或[创建](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingfactory.create.aspx)URI 方案是无效的。 属性值大于 32 KB。 | 检查调用代码，请确保参数正确。                                                                                                                                                                                                                                                                                                                                                           | 重试将于事无补。                                                                                                          |
| [MessagingEntityNotFoundException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingentitynotfoundexception.aspx)                                                                                                                                             | 与操作关联的实体不存在或已被删除。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 请确保该实体存在。                                                                                                                                                                                                                                                                                                                                                                                              | 重试将于事无补。                                                                                                          |
| [MessageNotFoundException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagenotfoundexception.aspx)                                                                                                                                                             | 尝试与一个特定的序列号收到一条消息。 找不到此消息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 请确保已没有收到消息。 检查以查看该邮件是否已 deadlettered deadletter 队列。                                                                                                                                                                                                                                                                                              | 重试将于事无补。                                                                                                          |
| [MessagingCommunicationException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingcommunicationexception.aspx)                                                                                                                                               | 客户端不能建立到事件集线器连接。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 请确保提供的主机名正确，主机可以访问。                                                                                                                                                                                                                                                                                                                                                    | 如果有间歇性连接问题可能有助于重试。                                                               |
| [ServerBusyException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.serverbusyexception.aspx)                                                                                                                                                                       | 服务并不能处理这次请求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 客户端可以等待一段时间，然后重试该操作。                                                                                                                                                                                                                                                                                                                                                           | 客户端可以在特定时间间隔后重试。 如果重试会导致一个不同的异常，请重试该异常行为。 |
| [MessageLockLostException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagelocklostexception.aspx)                                                                                                                                                             | 与消息关联的锁定标记已过期，或找不到的锁定标记。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 释放消息。                                                                                                                                                                                                                                                                                                                                                                                                      | 重试将于事无补。                                                                                                          |
| [SessionLockLostException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.sessionlocklostexception.aspx)                                                                                                                                                             | 与此会话关联的锁都将丢失。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 中止的[MessageSession](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagesession.aspx)对象。                                                                                                                                                                                                                                                                                           | 重试将于事无补。                                                                                                          |
| [MessagingException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.aspx)                                                                                                                                                                         | 一般消息可能在以下情况下引发的异常︰ 尝试创建[QueueClient](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.queueclient.aspx)使用一个名称或属于一个不同的实体类型 （例如，主题） 的路径。 试图发送邮件大于 256 KB。 服务器或服务请求的处理过程中遇到错误。 请异常消息的详细信息，参阅。 这通常是暂时的异常。                                                                                                               | 检查代码，并确保可序列化对象仅用于邮件正文 （或使用自定义序列化程序）。 查看受支持的值类型的属性，并仅使用受支持类型的文档。 检查[IsTransient](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingexception.istransient.aspx)属性。 如果为**true**，您可以重试操作。 | 重试的行为是未定义的可能没有任何帮助。                                                                               |
| [MessagingEntityAlreadyExistsException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingentityalreadyexistsexception.aspx)                                                                                                                                   | 尝试创建实体已由该服务命名空间中的另一个实体的名称。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 删除现有实体或另选一个名称为要创建的实体。                                                                                                                                                                                                                                                                                                                                       | 重试将于事无补。                                                                                                          |
| [QuotaExceededException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx)                                                                                                                                                                 | 消息传递实体已达到其允许的最大大小。 如果接收器的上限 （即 5） 已打开在每个使用者组级上就可以看见。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 通过从实体或其子队列接收消息的实体中创建空间。                                                                                                                                                                                                                                                                                                                                       | 如果在此期间已删除的邮件，可能有助于重试。                                                           
|
| [SessionCannotBeLockedException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.sessioncannotbelockedexception.aspx)                                                                                                                                                 | 尝试接受特定的会话 ID，但该会话已被另一个客户端当前锁定的会话。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 确保会话锁定其他客户端。                                                                                                                                                                                                                                                                                                                                                                       | 如果会话被释放在此期间，可能有助于重试。                                                             |
| [TransactionSizeExceededException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.transactionsizeexceededexception_methods.aspx)                                                                                                                                     | 太多的操作是事务的一部分。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 减少操作属于此交易记录的数目。                                                                                                                                                                                                                                                                                                                                                        | 重试将于事无补。                                                                                                          |
| [MessagingEntityDisabledException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagingentitydisabledexception.aspx)                                                                                                                                             | 运行时操作禁用实体上的的请求。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 激活该实体。                                                                                                                                                                                                                                                                                                                                                                                                      | 如果在此期间已激活实体可能有助于重试。                                                             |
| [MessageSizeExceededException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.messagesizeexceededexception.aspx)                                                                                                                                                     | 消息负载超过 256k 的限制。 请注意，256 k 限制全部消息大小，可以包括系统属性和任何.NET 开销。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 减小大小的消息负载，然后重试该操作。                                                                                                                                                                                                                                                                                                                                                         | 重试将于事无补。                                                                                                          |
| [TransactionException](https://msdn.microsoft.com/library/system.transactions.transactionexception.aspx)                                                                                                                                                                                      | 环境事务 (*Transaction.Current*) 是无效的。 该工作流可能已完成或中止。 内部异常可能会提供其他信息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                           | 重试将于事无补。                                                                                                          | -
| [TransactionInDoubtException](https://msdn.microsoft.com/library/system.transactions.transactionindoubtexception.aspx)                                                                                                                                                                        | 有疑问时，是的事务上尝试执行操作或尝试提交事务，该事务变得不确定。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 您的应用程序必须处理此异常 （作为一种特殊情况），因为交易记录可能已被确认。                                                                                                                                                                                                                                                                                                      | -                                                                                                                              |

## <a name="quotaexceededexception"></a>QuotaExceededException

[QuotaExceededException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx)表示特定实体的配额已被超过。

如果已在每个使用者组级别上开启接收器 (5) 的最大数目，可发生此错误。

### <a name="event-hubs"></a>事件集线器

事件集线器的每个事件中心的 20 使用者组的限制。 当您尝试创建更多时，您会收到[QuotaExceededException](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.quotaexceededexception.aspx)。 

## <a name="timeoutexception"></a>TimeoutException 

[TimeoutException](https://msdn.microsoft.com/library/system.timeoutexception.aspx)表明用户启动的操作花费的时间超过了操作超时。 

### <a name="event-hubs"></a>事件集线器

事件集线器的部件的连接字符串，或通过[ServiceBusConnectionStringBuilder](https://msdn.microsoft.com/library/azure/microsoft.servicebus.servicebusconnectionstringbuilder.aspx)为指定超时时间。 错误消息本身可能各不相同，但它始终包含指定为当前操作的超时值。 

### <a name="common-causes"></a>常见原因

有两个有关此错误的常见原因︰ 配置不正确或暂时性服务错误。

1. **不正确的配置**
   操作超时可能太小而无法运营的条件。 在客户端 SDK 中的操作超时值的默认值为 60 秒。 请检查您的代码是否具有值设置太小成。 请注意网络和 CPU 使用情况的条件可能会影响所需特定操作来完成，因此不应为很小的值设置操作超时的时间。

2. **瞬态服务错误**
   事件集线器服务有时可能会遇到延迟处理请求;例如，在高流量的时段。 在这种情况下，可以重试您的操作延迟后，直到操作成功。 如果尝试多次后，相同的操作仍然失败，请访问[Azure 服务状态的网站](https://azure.microsoft.com/status/)以查看是否存在任何已知的服务中断。

## <a name="next-steps"></a>下一步行动

完整的服务总线和事件集线器.NET API 参考，请参阅[MSDN 上的 Azure 引用](https://msdn.microsoft.com/library/azure/mt419900.aspx)。
